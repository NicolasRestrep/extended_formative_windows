md = sprintf("%04d", dateintv_2),
date_2 = paste(2020, substr(md, 1, 2),substr(md, 3, 4),
sep = "-"),
date_2 = ifelse(date_2 == "2020-00-NA", NA, date_2),
across(c(partyid_1a, partyid_1b, partyid_2),
~ifelse(.x %in% c(7,8,9), NA, .x)),
across(c(trust_1a, trust_1b, trust_2,
fair_1a, fair_1b, fair_2,
helpful_1a, helpful_1b, helpful_2),
~ifelse(.x == 3, 1.5, .x)),
across(partyid_1a:natcrime_2,
~as.character(.x))) %>%
select(id, weight_2, age_1a:age_2, date_1a, date_1b, date_2, partyid_1a:natcrime_2) %>%
pivot_longer(weight_2:natcrime_2) %>%
separate(name, into = c("measure", "wave")) %>%
mutate(wave = recode(wave, "1a"="1", "1b"="2", "2"="3")) %>%
spread(measure, value) %>%
mutate(date = as.Date(date),
across(c(weight, age, fair:trust),
~as.numeric(.x)),
partyid = (partyid/6)*100,
polviews = (polviews-1)/6*100,
across(c(trust, fair, helpful),
~(.x-1)*100),
across(c(natenvir, nataid,
natsoc, natchld,
natfare, natcrime),
~(.x-1)/2*100)) %>%
pivot_longer(fair:trust) %>%
filter(!is.na(value), !is.na(date)) %>% arrange(id, date) %>%
group_by(id, name) %>%
mutate(d1_value = lead(date) - date,
d2_value = lead(date,2) - date,
a1_value = abs(value - lead(value)),
a2_value = abs(value - lead(value,2))) %>%
pivot_longer(
cols = c(d1_value, d2_value,
a1_value, a2_value),
names_to = c(".value", "set"),
names_pattern = "(.)(.)_value") %>%
filter(!is.na(a)) %>%
mutate(d = d/365.25)%>%
ungroup()
gss6_long <- gss6 %>%
mutate(id = 1:nrow(gss6)) %>%
select(id,
wtpannr12, wtpannr123,
age_1, age_2, age_3,
dateintv_1, dateintv_2, dateintv_3,
partyid_1, partyid_2, partyid_3,
polviews_1, polviews_2, polviews_3,
trust_1, trust_2, trust_3,
fair_1, fair_2, fair_3,
helpful_1, helpful_2, helpful_3,
natenvir_1, natenvir_2, natenvir_3,
nataid_1, nataid_2, nataid_3,
natsoc_1, natsoc_2, natsoc_3,
natchld_1, natchld_2, natchld_3,
natfare_1, natfare_2, natfare_3,
natcrime_1, natcrime_2, natcrime_3) %>%
mutate(weight_2 = as.character(wtpannr12),
weight_3 = as.character(wtpannr123),
age_1 = ifelse(is.na(age_1) & !is.na(age_2), age_2 - 2, age_1),
age_1 = ifelse(is.na(age_1) & !is.na(age_3), age_3 - 4, age_1),
age_2 = ifelse(is.na(age_2), age_1 + 2, age_2),
age_3 = ifelse(is.na(age_3), age_1 + 4, age_3),
across(age_1:age_3, ~as.character(.x))) %>%
mutate(date_1 = paste(2006,substr(dateintv_1, 1, 1),substr(dateintv_1, 2, 3),
sep = "-"),
date_2 = paste(2008,substr(dateintv_2, 1, 1),substr(dateintv_2, 2, 3),
sep = "-"),
date_2 = ifelse(date_2 == "2008-NA-NA", NA, date_2),
date_3 = paste(2010,substr(dateintv_3, 1, 1),substr(dateintv_3, 2, 3),
sep = "-"),
date_3 = ifelse(date_3 == "2010-NA-NA", NA, date_3),
across(c(partyid_1, partyid_2, partyid_3), ~ifelse(.x %in% c(7), NA, .x)),
across(c(trust_1, trust_2, trust_3,
fair_1, fair_2, fair_3,
helpful_1, helpful_2, helpful_3),
~ifelse(.x == 3, 1.5, .x)),
across(partyid_1:natcrime_3,
~as.character(.x))) %>%
select(-c(dateintv_1, dateintv_2, dateintv_3)) %>%
pivot_longer(c(weight_2, weight_3, age_1:date_3)) %>%
separate(name, into = c("measure", "wave")) %>%
spread(measure, value) %>%
mutate(date = as.Date(date),
across(c(weight, age, fair:trust),
~as.numeric(.x)),
partyid = (partyid/6)*100,
polviews = (polviews-1)/6*100,
across(c(trust, fair,helpful),
~(.x-1)*100),
across(c(natenvir, nataid, natsoc, natchld,
natfare, natcrime),
~(.x-1)/2*100)) %>%
pivot_longer(fair:trust) %>%
na.omit() %>% arrange(id, date) %>%
group_by(id, name) %>%
mutate(d1_value = lead(date) - date,
d2_value = lead(date,2) - date,
a1_value = abs(value - lead(value)),
a2_value = abs(value - lead(value,2))) %>%
pivot_longer(
cols = c(d1_value, d2_value,
a1_value, a2_value),
names_to = c(".value", "set"),
names_pattern = "(.)(.)_value") %>%
filter(!is.na(a)) %>%
mutate(d = d/365.25)%>%
ungroup()
gss6_long
gss6_long <- gss6 %>%
mutate(id = 1:nrow(gss6)) %>%
select(id,
wtpannr12, wtpannr123,
age_1, age_2, age_3,
dateintv_1, dateintv_2, dateintv_3,
partyid_1, partyid_2, partyid_3,
polviews_1, polviews_2, polviews_3,
trust_1, trust_2, trust_3,
fair_1, fair_2, fair_3,
helpful_1, helpful_2, helpful_3,
natenvir_1, natenvir_2, natenvir_3,
nataid_1, nataid_2, nataid_3,
natsoc_1, natsoc_2, natsoc_3,
natchld_1, natchld_2, natchld_3,
natfare_1, natfare_2, natfare_3,
natcrime_1, natcrime_2, natcrime_3) %>%
mutate(weight_2 = as.character(wtpannr12),
weight_3 = as.character(wtpannr123),
age_1 = ifelse(is.na(age_1) & !is.na(age_2), age_2 - 2, age_1),
age_1 = ifelse(is.na(age_1) & !is.na(age_3), age_3 - 4, age_1),
age_2 = ifelse(is.na(age_2), age_1 + 2, age_2),
age_3 = ifelse(is.na(age_3), age_1 + 4, age_3),
across(age_1:age_3, ~as.character(.x))) %>%
mutate(date_1 = paste(2006,substr(dateintv_1, 1, 1),substr(dateintv_1, 2, 3),
sep = "-"),
date_2 = paste(2008,substr(dateintv_2, 1, 1),substr(dateintv_2, 2, 3),
sep = "-"),
date_2 = ifelse(date_2 == "2008-NA-NA", NA, date_2),
date_3 = paste(2010,substr(dateintv_3, 1, 1),substr(dateintv_3, 2, 3),
sep = "-"),
date_3 = ifelse(date_3 == "2010-NA-NA", NA, date_3),
across(c(partyid_1, partyid_2, partyid_3), ~ifelse(.x %in% c(7), NA, .x)),
across(c(trust_1, trust_2, trust_3,
fair_1, fair_2, fair_3,
helpful_1, helpful_2, helpful_3),
~ifelse(.x == 3, 1.5, .x)),
across(partyid_1:natcrime_3,
~as.character(.x))) %>%
select(-c(wtpannr12, wtpannr123, dateintv_1, dateintv_2, dateintv_3)) %>%
pivot_longer(c(weight_2, weight_3, age_1:date_3)) %>%
separate(name, into = c("measure", "wave")) %>%
spread(measure, value) %>%
mutate(date = as.Date(date),
across(c(weight, age, fair:trust),
~as.numeric(.x)),
partyid = (partyid/6)*100,
polviews = (polviews-1)/6*100,
across(c(trust, fair,helpful),
~(.x-1)*100),
across(c(natenvir, nataid, natsoc, natchld,
natfare, natcrime),
~(.x-1)/2*100)) %>%
pivot_longer(fair:trust) %>%
filter(!is.na(value), !is.na(age)) %>% arrange(id, date) %>%
group_by(id, name) %>%
mutate(d1_value = lead(date) - date,
d2_value = lead(date,2) - date,
a1_value = abs(value - lead(value)),
a2_value = abs(value - lead(value,2))) %>%
pivot_longer(
cols = c(d1_value, d2_value,
a1_value, a2_value),
names_to = c(".value", "set"),
names_pattern = "(.)(.)_value") %>%
filter(!is.na(a)) %>%
mutate(d = d/365.25)%>%
ungroup()
anes16_long <- anes16 %>%
mutate(id = 1:nrow(anes16)) %>%
zap_labels() %>%
select(id, V161267, V201507x,
V160102,#weight for pre- and post 2016
V200011a, #weight for pre-16 and pre-20 combined
V200011b, #weight for post-16 and post-20 combined
V164002, V165002, V203053, V203078,
V161158x, V201231x,
V161126, V162171, V201200,
V161153, V201347,
V161217, V201235,
V161216, V201234,
V161189, V201255,
V161184, V201252,
V161198, V201258,
V161232, V201336,
V161178, V201246,
V161181, V201249,
V161212, V201321,
V161205, V201300,
V161206, V201303,
V161209, V201312,
V161208, V201309,
V161211, V201318,
V161095, V201156,
V161096, V201157,
V162312, V202480,
V162314, V202482,
V162101, V202164,
V162097, V202161,
V162100, V202163,
V162098, V202162,
V162311, V202479,
V162103, V202166,
V162108, V202170,
V162110, V202171) %>%
mutate(age_1 = ifelse(V161267 < 0 & V201507x > 0, V201507x, ifelse(V161267 < 0, NA, V161267)),
age_2 = age_1,
age_3 = ifelse(!is.na(age_1) & V201507x < 0, age_1 + 4, V201507x),
age_4 = age_3,
across(age_1:age_4, ~as.character(.x))) %>%
mutate(weight_2 = as.character(V160102),
weight_3 = as.character(V200011a),
weight_4 = as.character(V200011b)) %>%
mutate(date_1 = convert_to_date(V164002),
date_2 = convert_to_date(V165002),
date_3 = convert_to_date(V203053),
date_4 = convert_to_date(V203078),
across(c(V161095, V201156,
V161096, V201157,
V162312, V202480,
V162314, V202482,
V162101, V202164,
V162097, V202161,
V162100, V202163,
V162098, V202162,
V162311, V202479,
V162103, V202166,
V162108, V202170,
V162110, V202171),
~ifelse(.x < 0 | .x > 100, NA, .x)),
across(c(V161158x, V201231x,
V161126, V162171, V201200,
V161153, V201347,
V161217, V201235,
V161216, V201234,
V161189, V201255,
V161184, V201252,
V161198, V201258,
V161178, V201246,
V161181, V201249),
~ifelse(.x < 0 | .x > 7, NA, .x)),
across(c(V161232, V201336),
~ifelse(.x < 0 | .x > 4, NA, .x)),
across(c(V161212, V201321,
V161205, V201300,
V161206, V201303,
V161209, V201312,
V161208, V201309,
V161211, V201318),
~ifelse(.x == 3, 1.5, ifelse(.x < 0, NA, .x))),
partyid_1 = as.character(V161158x),
partyid_3 = as.character(V201231x),
polviews_1 = as.character(V161126),
polviews_2 = as.character(V162171),
polviews_3 = as.character(V201200),
stayhome_1 = as.character(V161153),
stayhome_3 = as.character(V201347),
wastetax_1 = as.character(V161217),
wastetax_3 = as.character(V201235),
runfew_1 = as.character(V161216),
runfew_3 = as.character(V201234),
jobguar_1 = as.character(V161189),
jobguar_3 = as.character(V201255),
govins_1 = as.character(V161184),
govins_3 = as.character(V201252),
helpblk_1 = as.character(V161198),
helpblk_3 = as.character(V201258),
abortion_1 = as.character(V161232),
abortion_3 = as.character(V201336),
spendserv_1 = as.character(V161178),
spendserv_3 = as.character(V201246),
defscale_1 = as.character(V161181),
defscale_3 = as.character(V201249),
natenvir_1 = as.character(V161212),
natenvir_3 = as.character(V201321),
natsoc_1 = as.character(V161205),
natsoc_3 = as.character(V201300),
natschools_1 = as.character(V161206),
natschools_3 = as.character(V201303),
natfare_1 = as.character(V161209),
natfare_3 = as.character(V201312),
natcrime_1 = as.character(V161208),
natcrime_3 = as.character(V201309),
natpoor_1 = as.character(V161211),
natpoor_3 = as.character(V201318),
ftdems_1 = as.character(V161095),
ftdems_3 = as.character(V201156),
ftreps_1 = as.character(V161096),
ftreps_3 = as.character(V201157),
ftblacks_2 = as.character(V162312),
ftblacks_4 = as.character(V202480),
ftwhites_2 = as.character(V162314),
ftwhites_4 = as.character(V202482),
ftcons_2 = as.character(V162101),
ftcons_4 = as.character(V202164),
ftlibs_2 = as.character(V162097),
ftlibs_4 = as.character(V202161),
ftbiz_2 = as.character(V162100),
ftbiz_4 = as.character(V202163),
ftlabor_2 = as.character(V162098),
ftlabor_4 = as.character(V202162),
fthisp_2 = as.character(V162311),
fthisp_4 = as.character(V202479),
fthomo_2 = as.character(V162103),
fthomo_4 = as.character(V202166),
ftjews_2 = as.character(V162108),
ftjews_4 = as.character(V202170),
ftcops_2 = as.character(V162110),
ftcops_4 = as.character(V202171)) %>%
select(id, weight_2:weight_4, age_1:age_4, date_1:ftlabor_4) %>%
pivot_longer(weight_2:ftlabor_4) %>%
separate(name, into = c("measure", "wave")) %>%
spread(measure, value) %>%
mutate(date = as.Date(date),
across(c(weight, abortion, age, defscale:wastetax),
~as.numeric(.x)),
across(c(partyid, polviews, jobguar,
govins, helpblk, spendserv,
defscale),
~(.x-1)/6*100),
across(c(stayhome, runfew,
natenvir, natsoc, natschools, natfare,
natcrime, natpoor),
~(.x-1)*100),
across(c(wastetax),
~(.x-1)/2*100),
across(c(abortion),
~(.x-1)/3*100)) %>%
pivot_longer(c(abortion, defscale:wastetax)) %>%
filter(!is.na(age), !is.na(value)) %>% arrange(id, date) %>%
group_by(id, name) %>%
mutate(d1_value = lead(date) - date,
d2_value = lead(date,2) - date,
a1_value = abs(value - lead(value)),
a2_value = abs(value - lead(value,2))) %>%
pivot_longer(
cols = c(d1_value, d2_value,
a1_value, a2_value),
names_to = c(".value", "set"),
names_pattern = "(.)(.)_value") %>%
filter(!is.na(a)) %>%
mutate(d = d/365.25)%>%
ungroup()
anes20_long <- anes20 %>%
mutate(id = 1:nrow(anes20)) %>%
select(id, profile_age,
weight_pre, #weight for wave 1 only
weight_post, #weight for pre- and post-election combined
w3weight, #weight for data including wave 3
start, w2start, w3startdt,
pid7x, w2pid7x, w3pid7x,
lcself, w2lcself, w3lcself,
hp_you, w2hp_you,
ftdem, w2ftdem, w3ftdem,
ftrep, w2ftrep, w3ftrep,
w2ftgay, w3ftgay,
w2ftpolice, w3ftpolice) %>%
mutate(weight_1 = as.character(weight_pre),
weight_2 = as.character(weight_post),
weight_3 = as.character(w3weight)) %>%
mutate(age_1 = profile_age,
age_2 = profile_age,
age_3 = profile_age + 2,
across(age_1:age_3, ~as.character(.x))) %>%
mutate(date_1 = paste(substr(start, 1, 4), substr(start, 5, 6),substr(start, 7, 8),
sep = "-"),
date_2 = paste(substr(w2start, 1, 4), substr(w2start, 5, 6),substr(w2start, 7, 8),
sep = "-"),
date_3 = as.character(w3startdt),
across(c(pid7x, w2pid7x, w3pid7x),
~ifelse(.x %in% c(-7, -6), NA, .x - 1)),
across(c(lcself, w2lcself, w3lcself,
hp_you, w2hp_you),
~ifelse(.x %in% c(-7, -6, -1, 77, 98, 99), NA, .x-1)),
across(c(ftdem, w2ftdem, w3ftdem,
ftrep, w2ftrep, w3ftrep,
w2ftgay, w3ftgay,
w2ftpolice, w3ftpolice),
~ifelse(.x > 100 | .x < 0, NA, .x)),
partyid_1 = as.character(pid7x),
partyid_2 = as.character(w2pid7x),
partyid_3 = as.character(w3pid7x),
polviews_1 = as.character(lcself),
polviews_2 = as.character(w2lcself),
polviews_3 = as.character(w3lcself),
govins_1 = as.character(hp_you),
govins_2 = as.character(w2hp_you),
ftdems_1 = as.character(ftdem),
ftdems_2 = as.character(w2ftdem),
ftdems_3 = as.character(w3ftdem),
ftreps_1 = as.character(ftrep),
ftreps_2 = as.character(w2ftrep),
ftreps_3 = as.character(w3ftrep),
fthomo_2 = as.character(w2ftgay),
fthomo_3 = as.character(w3ftgay),
ftcops_2 = as.character(w2ftpolice),
ftcops_3 = as.character(w3ftpolice)) %>%
select(id, weight_1:weight_3, age_1:age_3, date_1:ftcops_3) %>%
pivot_longer(weight_1:ftcops_3) %>%
separate(name, into = c("measure", "wave")) %>%
spread(measure, value) %>%
mutate(date = as.Date(date),
across(c(weight, age, ftcops:polviews),
~as.numeric(.x)),
partyid = (partyid/6)*100,
across(c(polviews, govins),
~(.x - 1)/6*100)) %>%
pivot_longer(ftcops:polviews) %>%
filter(!is.na(value), !is.na(age)) %>% arrange(id, date) %>%
group_by(id, name) %>%
mutate(d1_value = lead(date) - date,
d2_value = lead(date,2) - date,
a1_value = abs(value - lead(value)),
a2_value = abs(value - lead(value,2))) %>%
pivot_longer(
cols = c(d1_value, d2_value,
a1_value, a2_value),
names_to = c(".value", "set"),
names_pattern = "(.)(.)_value") %>%
filter(!is.na(a)) %>%
mutate(d = d/365.25)%>%
ungroup()
anes16_long
anes20_long
gss20_long
gss6_long
gss8_long
gss8_long <- gss8 %>%
mutate(id = 1:nrow(gss8)) %>%
select(id,
wtpannr12, wtpannr123,
age_1, age_2, age_3,
dateintv_1, dateintv_2, dateintv_3,
partyid_1, partyid_2, partyid_3,
polviews_1, polviews_2, polviews_3,
trust_1, trust_2, trust_3,
fair_1, fair_2, fair_3,
helpful_1, helpful_2, helpful_3,
natenvir_1, natenvir_2, natenvir_3,
nataid_1, nataid_2, nataid_3,
natsoc_1, natsoc_2, natsoc_3,
natchld_1, natchld_2, natchld_3,
natfare_1, natfare_2, natfare_3,
natcrime_1, natcrime_2, natcrime_3) %>%
mutate(weight_2 = as.character(wtpannr12),
weight_3 = as.character(wtpannr123),
age_1 = ifelse(is.na(age_1) & !is.na(age_2), age_2 - 2, age_1),
age_1 = ifelse(is.na(age_1) & !is.na(age_3), age_3 - 4, age_1),
age_2 = ifelse(is.na(age_2), age_1 + 2, age_2),
age_3 = ifelse(is.na(age_3), age_1 + 4, age_3),
across(age_1:age_3, ~as.character(.x))) %>%
mutate(date_1 = paste(2008,substr(dateintv_1, 1, 1),substr(dateintv_1, 2, 3),
sep = "-"),
date_2 = paste(2010,substr(dateintv_2, 1, 1),substr(dateintv_2, 2, 3),
sep = "-"),
date_2 = ifelse(date_2 == "2010-NA-NA", NA, date_2),
date_3 = paste(2012,substr(dateintv_3, 1, 1),substr(dateintv_3, 2, 3),
sep = "-"),
date_3 = ifelse(date_3 == "2012-NA-NA", NA, date_3),
across(c(partyid_1, partyid_2, partyid_3), ~ifelse(.x %in% c(7), NA, .x)),
across(c(trust_1, trust_2, trust_3,
fair_1, fair_2, fair_3,
helpful_1, helpful_2, helpful_3), ~ifelse(.x == 3, 1.5, .x)),
across(partyid_1:natcrime_3,
~as.character(.x))) %>%
select(-c(wtpannr12, wtpannr123, dateintv_1, dateintv_2, dateintv_3)) %>%
pivot_longer(c(weight_2, weight_3, age_1:date_3)) %>%
separate(name, into = c("measure", "wave")) %>%
spread(measure, value) %>%
mutate(date = as.Date(date),
across(c(weight, age, fair:trust),
~as.numeric(.x)),
partyid = (partyid/6)*100,
polviews = (polviews-1)/6*100,
across(c(trust, fair,helpful),
~(.x-1)*100),
across(c(natenvir, nataid,
natsoc, natchld, natfare,
natcrime),
~(.x-1)/2*100)) %>%
pivot_longer(fair:trust) %>%
filter(!is.na(value), !is.na(age)) %>% arrange(id, date) %>%
group_by(id, name) %>%
mutate(d1_value = lead(date) - date,
d2_value = lead(date,2) - date,
a1_value = abs(value - lead(value)),
a2_value = abs(value - lead(value,2))) %>%
pivot_longer(
cols = c(d1_value, d2_value,
a1_value, a2_value),
names_to = c(".value", "set"),
names_pattern = "(.)(.)_value") %>%
filter(!is.na(a)) %>%
mutate(d = d/365.25)%>%
ungroup()
gss8_long
anes0$M000008
anes0 %>% select(M000523, M023038X, M045058x, WT00PRE, WT00PO, WT02PRE, WT02PO, WT04) %>% View()
anes0$WT00PRE
anes9$V900552
