<<<<<<< HEAD
M000678, M023054, M025116, M045076,
M000677, M023045, M025106, M045069, #aids
M000681, M023055, M025117, M045077, #socsec
M000683, M023047A, M025108A, M045071a, #schools
M000685, M023049, M025109, M045073,
M000676, M023046, M025107, M045070,
M000684, M023048, M025109, M045072,
M001308, M025055, M045023,
M001309, M025056, M045024,
M001310, M025057, M045025,
M001311, M025058, M045026,
M001313, M025060, M045028,
M001312, M025059, M045027,
M001306, M025053, M045021,
M001316, M025063, M045031,
M001321, M025067, M045035,
M001314, M025061, M045029,
M001323, M025068, M045036,
M001324, M025069, M045037,
#crooked (1quite, 35 -NA: 0,8,9)
M001537, M025177, M045152,
#wastetax (1lot, 35 - NA:0,8,9)
M001535, M025175, M045150,
#trustgov (123, recode 4, 0,8,9)
M001534, M025174, M045149,
#runfew (1few; 5all - NA: 0,8,9)
M001536, M025176, M045151
) %>%
zap_labels() %>%
mutate(date_1 = paste(2000,substr(M000008, 1, 2),substr(M000008, 3, 4),
sep = "-"),
date_2 = paste(2000,substr(M000130, 1, 2),substr(M000130, 3, 4),
sep = "-"),
date_2 = ifelse(date_2 %in% c("2000-00-00"), NA, date_2),
date_3 = paste(2002,substr(M022012C, 1, 2),substr(M022012C, 3, 4),
sep = "-"),
date_3 = ifelse(date_3 == "2002--", NA, date_3),
date_4 = paste(2002,substr(M024012C, 1, 2),substr(M024012C, 3, 4),
sep = "-"),
date_4 = ifelse(date_4 == "2002--", NA, date_4),
date_5 = paste(2004,substr(M044013b, 1, 2),substr(M044013b, 3, 4),
sep = "-"),
date_5 = ifelse(date_5 == "2004--", NA, date_5),
across(c(M001534, M025174, M045149),
~ifelse(.x == 4, 3, .x)),
across(c(M000682, M000678, M000677, M000681,
M000683, M000685, M000676, M000684),
~recode(.x, "1"=1, "5"=2, "3"=3, "7"=NA_real_)),
across(c(M023052, M025113, M045068,
M023054, M025116, M045076,
M023045, M025106, M045069,
M023055, M025117, M045077,
M023047A, M025108A, M045071a,
M023049, M025109, M045073,
M023046, M025107, M045070,
M023048, M025109, M045072),
~recode(.x, "1"=1, "2"=3, "3"=2)),
across(c(M000523, M023038X, M045058x),
~ifelse(.x %in% c(7,8,9), NA, .x)),
across(c(M000446, M001368, M023022),
~ifelse(.x %in% c(0,8,9,90), NA, .x)),
across(c(M001475, M025101, M045158,
M000513a, M023033, M045143,
M000545, M001385, M045127,
M001477, M025103, M045160,
M001476, M025102, M045159,
M001537, M025177, M045152,
M001535, M025175, M045150,
M001534, M025174, M045149,
M001536, M025176, M045151),
~ifelse(.x %in% c(0,8,9), NA, .x)),
across(c(M000694, M001403, M045110),
~ifelse(.x %in% c(0,7,8,9), NA, .x)),
across(c(
M001308, M025055, M045023,
M001309, M025056, M045024,
M001310, M025057, M045025,
M001311, M025058, M045026,
M001313, M025060, M045028,
M001312, M025059, M045027,
M001306, M025053, M045021,
M001316, M025063, M045031,
M001321, M025067, M045035,
M001314, M025061, M045029,
M001323, M025068, M045036,
M001324, M025069, M045037),
~ifelse(.x > 100, NA, .x)),
partyid_1 = as.character(M000523),
partyid_3 = as.character(M023038X),
partyid_5 = as.character(M045058x),
polviews_1 = as.character(M000446),
polviews_2 = as.character(M001368),
polviews_3 = as.character(M023022),
trust_2 = as.character(M001475),
trust_4 = as.character(M025101),
trust_5 = as.character(M045158),
helpful_2 = as.character(M001477),
helpful_4 = as.character(M025103),
helpful_5 = as.character(M045160),
fair_2 = as.character(M001476),
fair_4 = as.character(M025102),
fair_5 = as.character(M045159),
stayhome_1 = as.character(M000513a),
stayhome_3 = as.character(M023033),
stayhome_5 = as.character(M045143),
abortion_1 = as.character(M000694),
abortion_2 = as.character(M001403),
abortion_5 = as.character(M045110),
spendserv_1 = as.character(M000545),
spendserv_2 = as.character(M001385),
spendserv_5 = as.character(M045127),
natenvir_1 = as.character(M000682),
natenvir_3 = as.character(M023052),
natenvir_4 = as.character(M025113),
natenvir_5 = as.character(M045068),
nataid_1 = as.character(M000678),
nataid_3 = as.character(M023054),
nataid_4 = as.character(M025116),
nataid_5 = as.character(M045076),
nataids_1 = as.character(M000677),
nataids_3 = as.character(M023045),
nataids_4 = as.character(M025106),
nataids_5 = as.character(M045069),
natsoc_1 = as.character(M000681),
natsoc_3 = as.character(M023055),
natsoc_4 = as.character(M025117),
natsoc_5 = as.character(M045077),
natschools_1 = as.character(M000683),
natschools_3 = as.character(M023047A),
natschools_4 = as.character(M025108A),
natschools_5 = as.character(M045071a),
natchld_1 = as.character(M000685),
natchld_3 = as.character(M023049),
natchld_4 = as.character(M025109),
natchld_5 = as.character(M045073),
natfare_1 = as.character(M000676),
natfare_3 = as.character(M023046),
natfare_4 = as.character(M025107),
natfare_5 = as.character(M045070),
natcrime_1 = as.character(M000684),
natcrime_3 = as.character(M023048),
natcrime_4 = as.character(M025109),
natcrime_5 = as.character(M045072),
ftblacks_2 = as.character(M001308),
ftblacks_4 = as.character(M025055),
ftblacks_5 = as.character(M045023),
ftwhites_2 = as.character(M001309),
ftwhites_4 = as.character(M025056),
ftwhites_5 = as.character(M045024),
ftcons_2 = as.character(M001310),
ftcons_4 = as.character(M025057),
ftcons_5 = as.character(M045025),
ftlibs_2 = as.character(M001311),
ftlibs_4 = as.character(M025058),
ftlibs_5 = as.character(M045026),
ftbiz_2 = as.character(M001313),
ftbiz_4 = as.character(M025060),
ftbiz_5 = as.character(M045028),
ftlabor_2 = as.character(M001312),
ftlabor_4 = as.character(M025059),
ftlabor_5 = as.character(M045027),
ftmil_2 = as.character(M001306),
ftmil_4 = as.character(M025053),
ftmil_5 = as.character(M045021),
fthisp_2 = as.character(M001316),
fthisp_4 = as.character(M025063),
fthisp_5 = as.character(M045031),
fthomo_2 = as.character(M001321),
fthomo_4 = as.character(M025067),
fthomo_5 = as.character(M045035),
ftpoor_2 = as.character(M001314),
ftpoor_4 = as.character(M025061),
ftpoor_5 = as.character(M045029),
ftcath_2 = as.character(M001323),
ftcath_4 = as.character(M025068),
ftcath_5 = as.character(M045036),
ftjews_2 = as.character(M001324),
ftjews_4 = as.character(M025069),
ftjews_5 = as.character(M045037),
crooked_2 = as.character(M001537),
crooked_4 = as.character(M025177),
crooked_5 = as.character(M045152),
wastetax_2 = as.character(M001535),
wastetax_4 = as.character(M025175),
wastetax_5 = as.character(M045150),
trustgov_2 = as.character(M001534),
trustgov_4 = as.character(M025174),
trustgov_5 = as.character(M045149),
runfew_2 = as.character(M001536),
runfew_4 = as.character(M025176),
runfew_5 = as.character(M045151)) %>%
select(c(id, date_1:runfew_5)) %>%
pivot_longer(date_1:runfew_5) %>%
separate(name, into = c("measure", "wave")) %>%
spread(measure, value)
anes0_long <- anes0 %>%
mutate(id = 1:nrow(anes0)) %>%
select(id, M000008, M000130, M022012C, M024012C, M044013b,
M000523, M023038X, M045058x,
M000446, M001368, M023022,
M001475, M025101, M045158,
M001477, M025103, M045160,
M001476, M025102, M045159,
M000513a, M023033, M045143,
M000694, M001403, M045110,
M000545, M001385, M045127,
M000682, M023052, M025113, M045068,
M000678, M023054, M025116, M045076,
M000677, M023045, M025106, M045069, #aids
M000681, M023055, M025117, M045077, #socsec
M000683, M023047A, M025108A, M045071a, #schools
M000685, M023049, M025109, M045073,
M000676, M023046, M025107, M045070,
M000684, M023048, M025109, M045072,
M001308, M025055, M045023,
M001309, M025056, M045024,
M001310, M025057, M045025,
M001311, M025058, M045026,
M001313, M025060, M045028,
M001312, M025059, M045027,
M001306, M025053, M045021,
M001316, M025063, M045031,
M001321, M025067, M045035,
M001314, M025061, M045029,
M001323, M025068, M045036,
M001324, M025069, M045037,
#crooked (1quite, 35 -NA: 0,8,9)
M001537, M025177, M045152,
#wastetax (1lot, 35 - NA:0,8,9)
M001535, M025175, M045150,
#trustgov (123, recode 4, 0,8,9)
M001534, M025174, M045149,
#runfew (1few; 5all - NA: 0,8,9)
M001536, M025176, M045151
) %>%
zap_labels() %>%
mutate(date_1 = paste(2000,substr(M000008, 1, 2),substr(M000008, 3, 4),
sep = "-"),
date_2 = paste(2000,substr(M000130, 1, 2),substr(M000130, 3, 4),
sep = "-"),
date_2 = ifelse(date_2 %in% c("2000-00-00"), NA, date_2),
date_3 = paste(2002,substr(M022012C, 1, 2),substr(M022012C, 3, 4),
sep = "-"),
date_3 = ifelse(date_3 == "2002--", NA, date_3),
date_4 = paste(2002,substr(M024012C, 1, 2),substr(M024012C, 3, 4),
sep = "-"),
date_4 = ifelse(date_4 == "2002--", NA, date_4),
date_5 = paste(2004,substr(M044013b, 1, 2),substr(M044013b, 3, 4),
sep = "-"),
date_5 = ifelse(date_5 == "2004--", NA, date_5),
across(c(M001534, M025174, M045149),
~ifelse(.x == 4, 3, .x)),
across(c(M000682, M000678, M000677, M000681,
M000683, M000685, M000676, M000684),
~recode(.x, "1"=1, "5"=2, "3"=3, "7"=NA_real_)),
across(c(M023052, M025113, M045068,
M023054, M025116, M045076,
M023045, M025106, M045069,
M023055, M025117, M045077,
M023047A, M025108A, M045071a,
M023049, M025109, M045073,
M023046, M025107, M045070,
M023048, M025109, M045072),
~recode(.x, "1"=1, "2"=3, "3"=2)),
across(c(M000523, M023038X, M045058x),
~ifelse(.x %in% c(7,8,9), NA, .x)),
across(c(M000446, M001368, M023022),
~ifelse(.x %in% c(0,8,9,90), NA, .x)),
across(c(M001475, M025101, M045158,
M000513a, M023033, M045143,
M000545, M001385, M045127,
M001477, M025103, M045160,
M001476, M025102, M045159,
M001537, M025177, M045152,
M001535, M025175, M045150,
M001534, M025174, M045149,
M001536, M025176, M045151),
~ifelse(.x %in% c(0,8,9), NA, .x)),
across(c(M000694, M001403, M045110),
~ifelse(.x %in% c(0,7,8,9), NA, .x)),
across(c(
M001308, M025055, M045023,
M001309, M025056, M045024,
M001310, M025057, M045025,
M001311, M025058, M045026,
M001313, M025060, M045028,
M001312, M025059, M045027,
M001306, M025053, M045021,
M001316, M025063, M045031,
M001321, M025067, M045035,
M001314, M025061, M045029,
M001323, M025068, M045036,
M001324, M025069, M045037),
~ifelse(.x > 100, NA, .x)),
partyid_1 = as.character(M000523),
partyid_3 = as.character(M023038X),
partyid_5 = as.character(M045058x),
polviews_1 = as.character(M000446),
polviews_2 = as.character(M001368),
polviews_3 = as.character(M023022),
trust_2 = as.character(M001475),
trust_4 = as.character(M025101),
trust_5 = as.character(M045158),
helpful_2 = as.character(M001477),
helpful_4 = as.character(M025103),
helpful_5 = as.character(M045160),
fair_2 = as.character(M001476),
fair_4 = as.character(M025102),
fair_5 = as.character(M045159),
stayhome_1 = as.character(M000513a),
stayhome_3 = as.character(M023033),
stayhome_5 = as.character(M045143),
abortion_1 = as.character(M000694),
abortion_2 = as.character(M001403),
abortion_5 = as.character(M045110),
spendserv_1 = as.character(M000545),
spendserv_2 = as.character(M001385),
spendserv_5 = as.character(M045127),
natenvir_1 = as.character(M000682),
natenvir_3 = as.character(M023052),
natenvir_4 = as.character(M025113),
natenvir_5 = as.character(M045068),
nataid_1 = as.character(M000678),
nataid_3 = as.character(M023054),
nataid_4 = as.character(M025116),
nataid_5 = as.character(M045076),
nataids_1 = as.character(M000677),
nataids_3 = as.character(M023045),
nataids_4 = as.character(M025106),
nataids_5 = as.character(M045069),
natsoc_1 = as.character(M000681),
natsoc_3 = as.character(M023055),
natsoc_4 = as.character(M025117),
natsoc_5 = as.character(M045077),
natschools_1 = as.character(M000683),
natschools_3 = as.character(M023047A),
natschools_4 = as.character(M025108A),
natschools_5 = as.character(M045071a),
natchld_1 = as.character(M000685),
natchld_3 = as.character(M023049),
natchld_4 = as.character(M025109),
natchld_5 = as.character(M045073),
natfare_1 = as.character(M000676),
natfare_3 = as.character(M023046),
natfare_4 = as.character(M025107),
natfare_5 = as.character(M045070),
natcrime_1 = as.character(M000684),
natcrime_3 = as.character(M023048),
natcrime_4 = as.character(M025109),
natcrime_5 = as.character(M045072),
ftblacks_2 = as.character(M001308),
ftblacks_4 = as.character(M025055),
ftblacks_5 = as.character(M045023),
ftwhites_2 = as.character(M001309),
ftwhites_4 = as.character(M025056),
ftwhites_5 = as.character(M045024),
ftcons_2 = as.character(M001310),
ftcons_4 = as.character(M025057),
ftcons_5 = as.character(M045025),
ftlibs_2 = as.character(M001311),
ftlibs_4 = as.character(M025058),
ftlibs_5 = as.character(M045026),
ftbiz_2 = as.character(M001313),
ftbiz_4 = as.character(M025060),
ftbiz_5 = as.character(M045028),
ftlabor_2 = as.character(M001312),
ftlabor_4 = as.character(M025059),
ftlabor_5 = as.character(M045027),
ftmil_2 = as.character(M001306),
ftmil_4 = as.character(M025053),
ftmil_5 = as.character(M045021),
fthisp_2 = as.character(M001316),
fthisp_4 = as.character(M025063),
fthisp_5 = as.character(M045031),
fthomo_2 = as.character(M001321),
fthomo_4 = as.character(M025067),
fthomo_5 = as.character(M045035),
ftpoor_2 = as.character(M001314),
ftpoor_4 = as.character(M025061),
ftpoor_5 = as.character(M045029),
ftcath_2 = as.character(M001323),
ftcath_4 = as.character(M025068),
ftcath_5 = as.character(M045036),
ftjews_2 = as.character(M001324),
ftjews_4 = as.character(M025069),
ftjews_5 = as.character(M045037),
crooked_2 = as.character(M001537),
crooked_4 = as.character(M025177),
crooked_5 = as.character(M045152),
wastetax_2 = as.character(M001535),
wastetax_4 = as.character(M025175),
wastetax_5 = as.character(M045150),
trustgov_2 = as.character(M001534),
trustgov_4 = as.character(M025174),
trustgov_5 = as.character(M045149),
runfew_2 = as.character(M001536),
runfew_4 = as.character(M025176),
runfew_5 = as.character(M045151)) %>%
select(c(id, date_1:runfew_5)) %>%
pivot_longer(date_1:runfew_5) %>%
separate(name, into = c("measure", "wave")) %>%
spread(measure, value) %>%
mutate(date = as.Date(date),
across(c(abortion:crooked, fair:wastetax),
~as.numeric(.x)),
partyid = (partyid/6)*100,
across(c(polviews, spendserv),
~(.x-1)/6*100),
across(c(trust, fair, helpful,
stayhome, crooked, wastetax,
runfew),
~(.x - 1)/4*100),
abortion = (abortion-1)/3*100,
across(c(natenvir, nataid,
nataids, natsoc, natschools, natchld,
natfare, natcrime,
trustgov),
~(.x-1)/2*100)) %>%
pivot_longer(c(abortion:crooked, fair:wastetax)) %>%
na.omit() %>% arrange(id, date) %>%
group_by(id, name) %>%
mutate(d1_value = date - lag(date),
d2_value = date - lag(date, 2),
a1_value = abs(value - lag(value)),
a2_value = abs(value - lag(value,2))) %>%
pivot_longer(
cols = c(d1_value, d2_value,
a1_value, a2_value),
names_to = c(".value", "set"),
names_pattern = "(.)(.)_value") %>%
na.omit() %>%
mutate(d = d/365.25)%>%
ungroup()
anes0 %>% group_by(name) %>% summarise(meana = mean(a))
anes0_long %>% group_by(name) %>% summarise(meana = mean(a))
anes0_long %>% group_by(name) %>% summarise(meana = mean(a)) %>% View()
#Combine the data sets
long_data <- bind_rows(anes5_long %>% mutate(df = "1956-60 ANES"),
anes7_long %>% mutate(df = "1972-76 ANES"),
anes8_long %>% mutate(df = "1980 ANES"),
anes90_long %>% mutate(df = "1990-92 ANES"),
anes9_long %>% mutate(df = "1992-97 ANES"),
anes0_long %>% mutate(df = "2000-04 ANES"),
gss6_long %>% mutate(df = "2006-10 GSS"),
gss8_long %>% mutate(df = "2008-12 GSS"),
gss10_long %>% mutate(df = "2010-14 GSS"),
gss20_long %>% mutate(df = "2016-20 GSS"),
anes20_long %>% mutate(df = "2020-22 ANES")) %>%
ungroup() %>%
mutate(dec_diff = (as.numeric(difftime(date, min(date), units = "days")))/3652.5,
d = as.numeric(d))
long_data %>%
group_by(name, df) %>%
summarise(mean_d = mean(d), sd_d = sd(d), mean_a = mean(a),
sd_a = sd(a)) %>% View()
m1 <- lm(a ~ d + df + dec_diff + I(d*dec_diff), data = long_data)
summary(m1)
long_data %>%
ggplot(aes(x = d, y = a, color = df)) +
#geom_point(alpha = .1) +
geom_smooth(method = "lm", se = FALSE) +
#facet_wrap(~df) +
theme_bw() +
facet_wrap(~name) +
labs(x = "Duration between observations",
y = "Expected absolute difference",
color = "Panel") +
scale_color_viridis_d()
m2 <- lmer(a ~ d + dec_diff + I(d*dec_diff) + (1 + d + dec_diff | name),
data = long_data)
summary(m2)
test <- tidy(m2) %>%
filter(effect == "fixed") %>%
mutate(fe = estimate) %>%
select(term, fe)
augment(ranef(m2, condVar = TRUE)) %>%
left_join(test, by = c("variable"="term")) %>%
mutate(estimate = estimate + fe, lb = lb + fe, ub = ub + fe) %>%
ggplot(aes(x = estimate, y = level, xmin = lb, xmax = ub)) +
geom_vline(xintercept = 0, linetype = 2) +
geom_vline(data = tidy(fixef(m2)) %>% mutate(variable = names, estimate = x),
aes(xintercept = estimate), color = "firebrick", linetype = 2) +
geom_linerange() +
geom_point() +
facet_grid(.~variable, scales = "free_x") +
theme_bw()
long_data %>%
group_by(name) %>%
nest() %>%
mutate(t = map(data, lm_func)) %>%
unnest(t) %>%
filter(term == "date") %>%
unnest(data) %>%
mutate(direction = ifelse(estimate < 0, "negative", "positive")) %>%
ggplot(aes(x = date, y = a, color = direction)) +
facet_wrap(~reorder(name, estimate)) +
geom_smooth(method = "lm") +
theme_bw() +
labs(x = "Year", y = "Absolute difference")
long_data %>%
group_by(name) %>%
nest() %>%
mutate(t = map(data, lm_func)) %>%
unnest(t) %>%
filter(term == "date") %>%
unnest(data) %>%
mutate(direction = ifelse(estimate < 0, "negative", "positive")) %>%
ggplot(aes(x = date, y = a, color = direction)) +
facet_wrap(~reorder(name, estimate)) +
geom_smooth(method = "lm") +
theme_bw() +
labs(x = "Year", y = "Absolute difference")
=======
save(canes90, file = "~/Dropbox/extended_formative_windows/clean_data/canes90.Rdata")
save(canes9, file = "~/Dropbox/extended_formative_windows/clean_data/canes9.Rdata")
save(canes0, file = "~/Dropbox/extended_formative_windows/clean_data/canes0.Rdata")
demos <- bind_rows(clean_anes5 %>%
mutate(id = 1:nrow(clean_anes5),
marital_1 = ifelse(marital_1 == "single/nm", 0, 1)) %>%
select(id, age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(panel = "anes5"),
clean_anes7 %>%
select(id, age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(marital_1 = ifelse(marital_1 == "single/nm", 0, 1),
panel = "anes7"),
clean_anes8 %>%
select(id, age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(marital_1 = ifelse(marital_1 == "single/nm", 0, 1),
panel = "anes80"),
clean_anes90 %>%
mutate(id = 1:nrow(clean_anes90)) %>%
select(id, age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(marital_1 = ifelse(marital_1 == "single/nm", 0, 1),
panel = "anes90"),
clean_anes9 %>%
mutate(id = 1:nrow(clean_anes9)) %>%
select(id, age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(marital_1 = ifelse(marital_1 == "single/nm", 0, 1),
panel = "anes9"),
clean_anes2k %>%
select(id, age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(marital_1 = ifelse(marital_1 == "single/nm", 0, 1),
panel = "anes2k"),
clean_g6 %>%
mutate(id = 1:nrow(clean_g6),
marital_1 = ifelse(marital_1 == "single/nm", 0, 1)) %>%
select(age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(panel = "gss06"),
clean_g8 %>%
mutate(id = 1:nrow(clean_g8),
marital_1 = ifelse(marital_1 == "single/nm", 0, 1)) %>%
select(age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(panel = "gss08"),
clean_g10 %>%
mutate(id = 1:nrow(clean_g10),
marital_1 = ifelse(marital_1 == "single/nm", 0, 1)) %>%
select(age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(panel = "gss10"))
demos
demos %>%
mutate(ed_1 = ifelse(ed_1 == "ba", 1, 0)) %>%
pivot_longer(c(marital_1:student_1)) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other")))) %>%
group_by(age_group, panel, name) %>%
summarise(pct = mean(value, na.rm = TRUE)) %>%
mutate(year = recode(panel, "anes5"=1956, "anes7"=1972,
"anes80"=1980, "anes90"=1990,
"anes9"=1992, "anes2k"=2000, "gss06"=2006,
"gss08"=2008, "gss10"=2010)) %>%
filter(!is.na(age_group),
age_group != "other") %>%
mutate(name = recode(name, "child_1"="Child at home",
"ed_1"="Has B.A.",
"marital_1"="Ever married",
"student_1"="Currently student")) %>%
ggplot(aes(x = year, y = pct, color = age_group)) +
geom_point() +
geom_smooth(method = "lm", formula = y~x+I(x^2), se = FALSE,
alpha = .3) +
facet_wrap(~name) +
theme_bw() +
scale_color_brewer(type = "qual") +
labs(x = "Year", y = "Proportion",
color = "Age Group",
title = "Life course transtions by age group by year")
demos %>%
mutate(ed_1 = ifelse(ed_1 == "ba", 1, 0)) %>%
pivot_longer(c(marital_1:student_1)) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other")))) %>%
group_by(age_group, panel, name) %>%
summarise(pct = mean(value, na.rm = TRUE)) %>%
mutate(year = recode(panel, "anes5"=1956, "anes7"=1972,
"anes80"=1980, "anes90"=1990,
"anes9"=1992, "anes2k"=2000, "gss06"=2006,
"gss08"=2008, "gss10"=2010)) %>%
filter(!is.na(age_group),
age_group != "other") %>%
mutate(name = recode(name, "child_1"="Child at home",
"ed_1"="Has B.A.",
"marital_1"="Ever married",
"student_1"="Currently student")) %>%
ggplot(aes(x = year, y = pct)) +
geom_point(shape = 21, aes(fill = age_group)) +
geom_smooth(aes(color = age_group), method = "lm", formula = y~x+I(x^2), se = FALSE,
alpha = .3) +
facet_wrap(~name) +
theme_bw() +
scale_color_brewer(type = "qual") +
labs(x = "Year", y = "Proportion",
color = "Age Group",
title = "Life course transtions by age group by year")
demos %>%
mutate(ed_1 = ifelse(ed_1 == "ba", 1, 0)) %>%
pivot_longer(c(marital_1:student_1)) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other")))) %>%
group_by(age_group, panel, name) %>%
summarise(pct = mean(value, na.rm = TRUE)) %>%
mutate(year = recode(panel, "anes5"=1956, "anes7"=1972,
"anes80"=1980, "anes90"=1990,
"anes9"=1992, "anes2k"=2000, "gss06"=2006,
"gss08"=2008, "gss10"=2010)) %>%
filter(!is.na(age_group),
age_group != "other") %>%
mutate(name = recode(name, "child_1"="Child at home",
"ed_1"="Has B.A.",
"marital_1"="Ever married",
"student_1"="Currently student")) %>%
ggplot(aes(x = year, y = pct)) +
geom_point(shape = 21, aes(fill = age_group)) +
geom_smooth(aes(color = age_group), method = "lm", formula = y~x+I(x^2), se = FALSE,
alpha = .3) +
facet_wrap(~name) +
theme_bw() +
scale_color_brewer(type = "qual") +
scale_fill_brewer(type = "qual") +
labs(x = "Year", y = "Proportion",
color = "Age Group",
title = "Life course transtions by age group by year")
test <- bind_rows(cg6, cg8) %>%
pivot_longer(y1:y3) %>%
group_by(var) %>%
mutate(value = (value-min(value,na.rm=TRUE))/(max(value,na.rm=TRUE)-min(value,na.rm=TRUE))) %>%
mutate(wave = as.numeric(gsub("y", "", name))) %>%
select(-name) %>%
group_by(id, var) %>%
mutate(diff = abs(value-lag(value))) %>%
na.omit() %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
test
m1 <- lmer(diff ~ 1 + age_group + marital_1 + (1|var) + (1|id),
data = test)
library(lme4)
m1 <- lmer(diff ~ 1 + age_group + marital_1 + (1|var) + (1|id),
data = test)
summary(m1)
test <- bind_rows(cg6, cg8, cg10) %>%
pivot_longer(y1:y3) %>%
group_by(var) %>%
mutate(value = (value-min(value,na.rm=TRUE))/(max(value,na.rm=TRUE)-min(value,na.rm=TRUE))) %>%
mutate(wave = as.numeric(gsub("y", "", name))) %>%
select(-name) %>%
group_by(id, var) %>%
mutate(diff = abs(value-lag(value))) %>%
na.omit() %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
m1 <- lmer(diff ~ 1 + age_group + marital_1 + (1|var) + (1|id),
data = test)
test
test <- bind_rows(cg6, cg8) %>%
pivot_longer(y1:y3) %>%
group_by(var) %>%
mutate(value = (value-min(value,na.rm=TRUE))/(max(value,na.rm=TRUE)-min(value,na.rm=TRUE))) %>%
mutate(wave = as.numeric(gsub("y", "", name))) %>%
select(-name) %>%
group_by(id, var) %>%
mutate(diff = abs(value-lag(value))) %>%
na.omit() %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
m1 <- lmer(diff ~ 1 + age_group + marital_1 + (1|var) + (1|id),
data = test)
summary(m1)
ranef(m1)
plot(ranef(m1))
names(clean_anes5)
clean_anes7$thermwhite_1
clean_anes2k$thermwhites_1
anes7
canes7
canes5
canes9
bind_rows(canes7, canes9)
bind_rows(canes7 %>% mutate(year = 1972), canes9 %>% select(weight) %>% mutate(year = 1992))
bind_rows(canes7 %>% mutate(year = 1972), canes9 %>% select(-weight) %>% mutate(year = 1992))
canes7$var
bind_rows(canes7 %>% mutate(year = 1972), canes9 %>% select(-weight) %>% mutate(year = 1992)) %>%
filter(var %in% c("thermwhite", "thermwhites"))
test <- bind_rows(canes7 %>% mutate(year = 1972), canes9 %>% select(-weight) %>% mutate(year = 1992)) %>%
filter(var %in% c("thermwhite", "thermwhites"))
test
table(test$var)
canes0
table(canes0$ var)
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% select(-weight) %>% mutate(year == 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites"))
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year == 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites"))
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites"))
test
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var))
table(test$var)
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3)
test
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by()
test
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(change = value - lag(value))
test
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100)
test
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100) %>%
mutate(change = value - lag(value))
test
m1 <- lmer(diff ~ 1 + age_group + year + (1|id),
data = test)
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100) %>%
mutate(change = value - lag(value)) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
m1 <- lmer(diff ~ 1 + age_group + year + (1|id),
data = test)
test
m1 <- lmer(change ~ 1 + age_group + year + (1|id),
data = test)
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100) %>%
mutate(change = abs(value - lag(value))) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
m1 <- lmer(change ~ 1 + age_group + year + (1|id),
data = test)
summary(m1)
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100,
year = year/10) %>%
mutate(change = abs(value - lag(value))) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100,
year = (year-1972)/10) %>%
mutate(change = abs(value - lag(value))) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
m1 <- lmer(change ~ 1 + age_group + year + (1|id),
data = test)
summary(m1)
test %>%
ggplot(aes(x = year, y = change)) +
geom_point()
test %>%
ggplot(aes(x = year, y = change, fill = age_group)) +
geom_point(shape = 21)
test %>%
group_by(age_group, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21)
test %>%
group_by(age_group, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21)
test %>%
group_by(age_group, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth()
test %>%
group_by(age_group, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(method = "lm")
test %>%
group_by(age_group, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(method = "lm", se  FALSE)
test %>%
group_by(age_group, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(method = "lm", se = FALSE)
test %>%
group_by(age_group, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(aes(color = age_group), method = "lm", se = FALSE)
canes0$var
canes7$var
bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites", "thermblacks", "thermbiz",
"thermcons", "thermlibs", "thermunion"))
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites", "thermblacks", "thermbiz",
"thermcons", "thermlibs", "thermunion")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100,
year = (year-1972)/10) %>%
mutate(change = abs(value - lag(value))) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
table(test$var)
test %>%
group_by(age_group, var, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(aes(color = age_group), method = "lm", se = FALSE)
test %>%
group_by(age_group, var, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(aes(color = age_group), method = "lm", se = FALSE) +
facet_wrap(~var)
m1 <- lmer(change ~ 1 + year + (1 + year | age_group),
data = test)
summary(m1)
test
summary(m1)
ranef(m1)
canes7
clean_anes7$partyid_1
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites", "thermblacks", "thermbiz",
"thermcons", "thermlibs", "thermunion",
"partyid")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100,
year = (year-1972)/10) %>%
mutate(change = abs(value - lag(value))) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
test %>%
group_by(age_group, var, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(aes(color = age_group), method = "lm", se = FALSE) +
facet_wrap(~var) +
theme_minimal()
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites", "thermblacks", "thermbiz",
"thermcons", "thermlibs", "thermunion",
"partyid", "polviews")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100,
year = (year-1972)/10) %>%
mutate(change = abs(value - lag(value))) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
test %>%
group_by(age_group, var, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(aes(color = age_group), method = "lm", se = FALSE) +
facet_wrap(~var) +
theme_minimal()
test %>%
group_by(age_group, var, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(aes(color = age_group), method = "lm", se = FALSE) +
facet_wrap(~var, scales = "free_y") +
theme_minimal()
canes0
table(canes0$var)
m1 <- lmer(change ~ 1 + year + (1 + year | age_group),
data = test)
summary(m1)
m1 <- lmer(change ~ 1 + year + (1 + year | var),
data = test)
summary(m1)
>>>>>>> 8ff2e75ee761fbe1cf53507f282ef499819f9264
