save(canes90, file = "~/Dropbox/extended_formative_windows/clean_data/canes90.Rdata")
save(canes9, file = "~/Dropbox/extended_formative_windows/clean_data/canes9.Rdata")
save(canes0, file = "~/Dropbox/extended_formative_windows/clean_data/canes0.Rdata")
demos <- bind_rows(clean_anes5 %>%
mutate(id = 1:nrow(clean_anes5),
marital_1 = ifelse(marital_1 == "single/nm", 0, 1)) %>%
select(id, age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(panel = "anes5"),
clean_anes7 %>%
select(id, age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(marital_1 = ifelse(marital_1 == "single/nm", 0, 1),
panel = "anes7"),
clean_anes8 %>%
select(id, age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(marital_1 = ifelse(marital_1 == "single/nm", 0, 1),
panel = "anes80"),
clean_anes90 %>%
mutate(id = 1:nrow(clean_anes90)) %>%
select(id, age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(marital_1 = ifelse(marital_1 == "single/nm", 0, 1),
panel = "anes90"),
clean_anes9 %>%
mutate(id = 1:nrow(clean_anes9)) %>%
select(id, age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(marital_1 = ifelse(marital_1 == "single/nm", 0, 1),
panel = "anes9"),
clean_anes2k %>%
select(id, age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(marital_1 = ifelse(marital_1 == "single/nm", 0, 1),
panel = "anes2k"),
clean_g6 %>%
mutate(id = 1:nrow(clean_g6),
marital_1 = ifelse(marital_1 == "single/nm", 0, 1)) %>%
select(age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(panel = "gss06"),
clean_g8 %>%
mutate(id = 1:nrow(clean_g8),
marital_1 = ifelse(marital_1 == "single/nm", 0, 1)) %>%
select(age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(panel = "gss08"),
clean_g10 %>%
mutate(id = 1:nrow(clean_g10),
marital_1 = ifelse(marital_1 == "single/nm", 0, 1)) %>%
select(age_1, marital_1, child_1, ed_1, student_1) %>%
mutate(panel = "gss10"))
demos
demos %>%
mutate(ed_1 = ifelse(ed_1 == "ba", 1, 0)) %>%
pivot_longer(c(marital_1:student_1)) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other")))) %>%
group_by(age_group, panel, name) %>%
summarise(pct = mean(value, na.rm = TRUE)) %>%
mutate(year = recode(panel, "anes5"=1956, "anes7"=1972,
"anes80"=1980, "anes90"=1990,
"anes9"=1992, "anes2k"=2000, "gss06"=2006,
"gss08"=2008, "gss10"=2010)) %>%
filter(!is.na(age_group),
age_group != "other") %>%
mutate(name = recode(name, "child_1"="Child at home",
"ed_1"="Has B.A.",
"marital_1"="Ever married",
"student_1"="Currently student")) %>%
ggplot(aes(x = year, y = pct, color = age_group)) +
geom_point() +
geom_smooth(method = "lm", formula = y~x+I(x^2), se = FALSE,
alpha = .3) +
facet_wrap(~name) +
theme_bw() +
scale_color_brewer(type = "qual") +
labs(x = "Year", y = "Proportion",
color = "Age Group",
title = "Life course transtions by age group by year")
demos %>%
mutate(ed_1 = ifelse(ed_1 == "ba", 1, 0)) %>%
pivot_longer(c(marital_1:student_1)) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other")))) %>%
group_by(age_group, panel, name) %>%
summarise(pct = mean(value, na.rm = TRUE)) %>%
mutate(year = recode(panel, "anes5"=1956, "anes7"=1972,
"anes80"=1980, "anes90"=1990,
"anes9"=1992, "anes2k"=2000, "gss06"=2006,
"gss08"=2008, "gss10"=2010)) %>%
filter(!is.na(age_group),
age_group != "other") %>%
mutate(name = recode(name, "child_1"="Child at home",
"ed_1"="Has B.A.",
"marital_1"="Ever married",
"student_1"="Currently student")) %>%
ggplot(aes(x = year, y = pct)) +
geom_point(shape = 21, aes(fill = age_group)) +
geom_smooth(aes(color = age_group), method = "lm", formula = y~x+I(x^2), se = FALSE,
alpha = .3) +
facet_wrap(~name) +
theme_bw() +
scale_color_brewer(type = "qual") +
labs(x = "Year", y = "Proportion",
color = "Age Group",
title = "Life course transtions by age group by year")
demos %>%
mutate(ed_1 = ifelse(ed_1 == "ba", 1, 0)) %>%
pivot_longer(c(marital_1:student_1)) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other")))) %>%
group_by(age_group, panel, name) %>%
summarise(pct = mean(value, na.rm = TRUE)) %>%
mutate(year = recode(panel, "anes5"=1956, "anes7"=1972,
"anes80"=1980, "anes90"=1990,
"anes9"=1992, "anes2k"=2000, "gss06"=2006,
"gss08"=2008, "gss10"=2010)) %>%
filter(!is.na(age_group),
age_group != "other") %>%
mutate(name = recode(name, "child_1"="Child at home",
"ed_1"="Has B.A.",
"marital_1"="Ever married",
"student_1"="Currently student")) %>%
ggplot(aes(x = year, y = pct)) +
geom_point(shape = 21, aes(fill = age_group)) +
geom_smooth(aes(color = age_group), method = "lm", formula = y~x+I(x^2), se = FALSE,
alpha = .3) +
facet_wrap(~name) +
theme_bw() +
scale_color_brewer(type = "qual") +
scale_fill_brewer(type = "qual") +
labs(x = "Year", y = "Proportion",
color = "Age Group",
title = "Life course transtions by age group by year")
test <- bind_rows(cg6, cg8) %>%
pivot_longer(y1:y3) %>%
group_by(var) %>%
mutate(value = (value-min(value,na.rm=TRUE))/(max(value,na.rm=TRUE)-min(value,na.rm=TRUE))) %>%
mutate(wave = as.numeric(gsub("y", "", name))) %>%
select(-name) %>%
group_by(id, var) %>%
mutate(diff = abs(value-lag(value))) %>%
na.omit() %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
test
m1 <- lmer(diff ~ 1 + age_group + marital_1 + (1|var) + (1|id),
data = test)
library(lme4)
m1 <- lmer(diff ~ 1 + age_group + marital_1 + (1|var) + (1|id),
data = test)
summary(m1)
test <- bind_rows(cg6, cg8, cg10) %>%
pivot_longer(y1:y3) %>%
group_by(var) %>%
mutate(value = (value-min(value,na.rm=TRUE))/(max(value,na.rm=TRUE)-min(value,na.rm=TRUE))) %>%
mutate(wave = as.numeric(gsub("y", "", name))) %>%
select(-name) %>%
group_by(id, var) %>%
mutate(diff = abs(value-lag(value))) %>%
na.omit() %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
m1 <- lmer(diff ~ 1 + age_group + marital_1 + (1|var) + (1|id),
data = test)
test
test <- bind_rows(cg6, cg8) %>%
pivot_longer(y1:y3) %>%
group_by(var) %>%
mutate(value = (value-min(value,na.rm=TRUE))/(max(value,na.rm=TRUE)-min(value,na.rm=TRUE))) %>%
mutate(wave = as.numeric(gsub("y", "", name))) %>%
select(-name) %>%
group_by(id, var) %>%
mutate(diff = abs(value-lag(value))) %>%
na.omit() %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
m1 <- lmer(diff ~ 1 + age_group + marital_1 + (1|var) + (1|id),
data = test)
summary(m1)
ranef(m1)
plot(ranef(m1))
names(clean_anes5)
clean_anes7$thermwhite_1
clean_anes2k$thermwhites_1
anes7
canes7
canes5
canes9
bind_rows(canes7, canes9)
bind_rows(canes7 %>% mutate(year = 1972), canes9 %>% select(weight) %>% mutate(year = 1992))
bind_rows(canes7 %>% mutate(year = 1972), canes9 %>% select(-weight) %>% mutate(year = 1992))
canes7$var
bind_rows(canes7 %>% mutate(year = 1972), canes9 %>% select(-weight) %>% mutate(year = 1992)) %>%
filter(var %in% c("thermwhite", "thermwhites"))
test <- bind_rows(canes7 %>% mutate(year = 1972), canes9 %>% select(-weight) %>% mutate(year = 1992)) %>%
filter(var %in% c("thermwhite", "thermwhites"))
test
table(test$var)
canes0
table(canes0$ var)
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% select(-weight) %>% mutate(year == 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites"))
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year == 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites"))
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites"))
test
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var))
table(test$var)
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3)
test
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by()
test
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(change = value - lag(value))
test
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100)
test
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100) %>%
mutate(change = value - lag(value))
test
m1 <- lmer(diff ~ 1 + age_group + year + (1|id),
data = test)
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100) %>%
mutate(change = value - lag(value)) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
m1 <- lmer(diff ~ 1 + age_group + year + (1|id),
data = test)
test
m1 <- lmer(change ~ 1 + age_group + year + (1|id),
data = test)
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100) %>%
mutate(change = abs(value - lag(value))) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
m1 <- lmer(change ~ 1 + age_group + year + (1|id),
data = test)
summary(m1)
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100,
year = year/10) %>%
mutate(change = abs(value - lag(value))) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100,
year = (year-1972)/10) %>%
mutate(change = abs(value - lag(value))) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
m1 <- lmer(change ~ 1 + age_group + year + (1|id),
data = test)
summary(m1)
test %>%
ggplot(aes(x = year, y = change)) +
geom_point()
test %>%
ggplot(aes(x = year, y = change, fill = age_group)) +
geom_point(shape = 21)
test %>%
group_by(age_group, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21)
test %>%
group_by(age_group, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21)
test %>%
group_by(age_group, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth()
test %>%
group_by(age_group, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(method = "lm")
test %>%
group_by(age_group, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(method = "lm", se  FALSE)
test %>%
group_by(age_group, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(method = "lm", se = FALSE)
test %>%
group_by(age_group, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(aes(color = age_group), method = "lm", se = FALSE)
canes0$var
canes7$var
bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites", "thermblacks", "thermbiz",
"thermcons", "thermlibs", "thermunion"))
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites", "thermblacks", "thermbiz",
"thermcons", "thermlibs", "thermunion")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100,
year = (year-1972)/10) %>%
mutate(change = abs(value - lag(value))) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
table(test$var)
test %>%
group_by(age_group, var, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(aes(color = age_group), method = "lm", se = FALSE)
test %>%
group_by(age_group, var, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(aes(color = age_group), method = "lm", se = FALSE) +
facet_wrap(~var)
m1 <- lmer(change ~ 1 + year + (1 + year | age_group),
data = test)
summary(m1)
test
summary(m1)
ranef(m1)
canes7
clean_anes7$partyid_1
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites", "thermblacks", "thermbiz",
"thermcons", "thermlibs", "thermunion",
"partyid")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100,
year = (year-1972)/10) %>%
mutate(change = abs(value - lag(value))) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
test %>%
group_by(age_group, var, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(aes(color = age_group), method = "lm", se = FALSE) +
facet_wrap(~var) +
theme_minimal()
test <- bind_rows(canes7 %>% mutate(year = 1972),
canes9 %>% select(-weight) %>% mutate(year = 1992),
canes0 %>% mutate(year = 2000)) %>%
filter(var %in% c("thermwhite", "thermwhites", "thermblacks", "thermbiz",
"thermcons", "thermlibs", "thermunion",
"partyid", "polviews")) %>%
mutate(var = ifelse(var == "thermwhite", "thermwhites", var)) %>%
pivot_longer(y1:y3) %>%
filter(!is.na(value)) %>%
group_by(id, year) %>%
mutate(value = value/100,
year = (year-1972)/10) %>%
mutate(change = abs(value - lag(value))) %>%
mutate(age_group = ifelse(age_1 < 26, "18-25",
ifelse(age_1 >= 26 & age_1 < 34, "26-33",
ifelse(age_1 >= 34 & age_1 < 43, "34-41",
"other"))))
test %>%
group_by(age_group, var, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(aes(color = age_group), method = "lm", se = FALSE) +
facet_wrap(~var) +
theme_minimal()
test %>%
group_by(age_group, var, year) %>%
summarise(mean_change = mean(change, na.rm=TRUE)) %>%
filter(!is.na(age_group)) %>%
ggplot(aes(x = year, y = mean_change, fill = age_group)) +
geom_point(shape = 21) +
geom_smooth(aes(color = age_group), method = "lm", se = FALSE) +
facet_wrap(~var, scales = "free_y") +
theme_minimal()
canes0
table(canes0$var)
m1 <- lmer(change ~ 1 + year + (1 + year | age_group),
data = test)
summary(m1)
m1 <- lmer(change ~ 1 + year + (1 + year | var),
data = test)
summary(m1)
