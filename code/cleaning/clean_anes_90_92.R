
# cleaning/clean_anes_90_92.R

source("code/cleaning/utils.R")


clean_anes_90_92 <- function(path) {
  
  anes90 <- read_and_zap(path)
  
  cleaned <- anes90 %>%
    mutate(id = row_number()) %>%
    select(id,
           V923009,
           V900552, V923903,
           V900052, V900053, V912032, V923026, V923027, V925005, V925006,
           V900320, V912333, V923634,
           V900406, V912450, V923509,
           V912831, V926139,
           V900498, V912485, V923604,
           V900446, V923718,
           V900447, V923724,
           V900479, V923732,
           V900452, V912600, V923701,
           V900377, V923815,
           V900379, V923727,
           V900380, V923811,
           V900382, V923725,
           V900383, V923818,
           V900384, V923730,
           V900385, V923813,
           V900439, V912475, V923707,
           V900151, V912222, V923317,
           V900152, V912228, V923318,
           V900155, V912232, V925323,
           V912231, V925333,
           V900156, V912220, V925319,
           V900161, V912226, V925326,
           V900157, V925316,
           V912233, V925327,
           V900158, V912239, V925324,
           V900438, V923801,
           V900507, V926123,
           V900505, V926121,
           V900504, V912487, V926120,
           V900506, V912488, V926122, 
           # Attention political campaigns(1,3)
           V900062,	V923101, 
           # People like me Likert (1-4)
           V900509,	V912489, V926102,
           # Less gvtment 
           V900333,	V925729, 
           # Preferential hiring
           V900463,	V912558, V925935, 
           # Death Penalty 
           V900477,	V925933, 
           # Immigrants decrease 
           V912619,	V926235, 
           # T: asian-americans
           V912235,	V925339, 
           # T: Feminists
           V912240,	V925317, 
           # T: welfare
           V900159, V925318, 
           # T: environmentalists 
           V912230,	V925329, 
           # T: illegal immigrants 
           V912234, V925331, 
           # Equal Op Success 
           V900426, V926024, 
           # Equal rights too far 
           V900427,	V912705,	V926025, 
           # Not everyone chance 
           V900428, V926029, 
           # Worry less equality
           V900429,	V926026, 
           # More chances are not a problem
           V900430, V926027, 
           # If people were treated equally
           V900431,	V912703, V926028, 
           # Moral relativity 
           V900501,	V912702, V926115, 
           # Traditional family ties 
           V900502, V926117, 
           # Slavery difficulty
           V900523, V926129, 
           # Irish and italians worked 
           V900521, V926126, 
           # Matter of hard work
           V900522, V926128, 
           # Religion Important 
           V900511, V923820,
           # complicated (1,4 . 5-pt sclae)
           V900510, V926104,
           # dont care (1,4. 5-pt scale)
           V900508, V926103) %>% 
    mutate(weight_3 = as.character(V923009),
           weight_4 = weight_3,
           weight_2 = weight_3,
           across(c(V900552, V923903), 
                  ~ifelse(.x == 0, NA, .x)),
           age_1 = V900552,
           age_2 = age_1 + 1,
           age_3 = ifelse(is.na(V923903), age_1 + 2, V923903),
           age_4 = age_3,
           across(c(age_1:age_4), ~as.character(.x))) %>% 
    mutate(year = ifelse(V900052 %in% c(1,2), "1991", "1990"),
           date_1 = paste(year, sprintf("%02d", V900052), sprintf("%02d", V900053), sep = "-")) %>% 
    mutate(md = sprintf("%04d", V912032),
           date_2 = paste("1991", substr(md, 1, 2), substr(md, 3, 4), sep = "-"),
           date_2 = ifelse(date_2 == "1991-00-00", NA, date_2)) %>% 
    select(-c(md)) %>%
    mutate(date_3 = paste("1992", sprintf("%02d", V923026), sprintf("%02d", V923027),
                          sep = "-"),
           date_3 = ifelse(date_3 == "1992-00-00", NA, date_3)) %>% 
    mutate(year = ifelse(V925005 == 1, "1993", "1992"),
           date_4 = paste(year, sprintf("%02d", V925005), sprintf("%02d", V925006),
                          sep = "-"),
           date_4 = ifelse(date_4 == "1992-00-00", NA, date_4)) %>% 
    select(-year) %>% 
    mutate(across(c(V900504, V912487, V926120),
                  ~ifelse(.x == 7, 5, .x)),
           across(c(V900320, V912333, V923634), ~ifelse(.x %in% c(7,8,9), NA, .x)),
           across(c(V900406, V912450, V923509,
                    V912831, V926139,
                    V900498, V912485, V923604,
                    V900446, V923718,
                    V900447, V923724,
                    V900452, V912600, V923701,
                    V900439, V912475, V923707,
                    V900438, V923801,
                    V900507, V926123,
                    V900505, V926121,
                    V900504, V912487, V926120,
                    V900506, V912488, V926122, 
                    V900333, V925729, 
                    V900463,	V912558, V925935, 
                    V900477,	V925933, 
                    V912619,	V926235, 
                    V900426, V926024, 
                    V900427,	V912705,	V926025, 
                    V900428, V926029, 
                    V900429, V926026, 
                    V900430, V926027, 
                    V900431, V912703, V926028, 
                    V900501,	V912702, V926115, 
                    V900502, V926117, 
                    V900523, V926129, 
                    V900521, V926126, 
                    V900511, V923820,
                    V900522, V926128,
                    V900062, V923101), 
                  ~ifelse(.x %in% c(0,8, 9), NA, .x)),
           across(c(V900510, V926104,
                    V900508, V926103,
                    V900509, V912489, V926102),
                  ~recode(.x, "1"=1, "2"=1, "3"=3, "4"=5, "5"=5,
                          "8"=3, "9"=NA_real_, "0"=NA_real_)),
           V912558 = ifelse(V912558 == 3, NA, V912558),
           across(c(V900479, V923732,
                    V900377, V923815,
                    V900379, V923727,
                    V900380, V923811,
                    V900382, V923725,
                    V900383, V923818,
                    V900384, V923730,
                    V900385, V923813), ~ifelse(.x %in% c(0,6,7,8,9), NA, .x)),
           across(c(V900151, V912222, V923317,
                    V900152, V912228, V923318,
                    V900155, V912232, V925323,
                    V912231, V925333,
                    V900156, V912220, V925319,
                    V900161, V912226, V925326,
                    V900157, V925316,
                    V912233, V925327,
                    V900158, V912239, V925324, 
                    V912235, V925339, 
                    V912240, V925317, 
                    V900159, V925318, 
                    V912230, V925329, 
                    V912234, V925331),
                  ~ifelse(.x %in% c(888,997,998,999), NA, .x))) %>%
    mutate(partyid_1 = as.character(V900320),
           partyid_2 = as.character(V912333), 
           partyid_3 = as.character(V923634),
           polviews_1 = as.character(V900406),
           polviews_2 = as.character(V912450),
           polviews_3 = as.character(V923509),
           trust_2 =as.character(V912831),
           trust_4 = as.character(V926139),
           stayhome_1 = as.character(V900498),
           stayhome_2 = as.character(V912485),
           stayhome_3 = as.character(V923604),
           jobguar_1 = as.character(V900446),
           jobguar_3 = as.character(V923718),
           helpblk_1 = as.character(V900447), 
           helpblk_3 = as.character(V923724),
           abortion_1 = as.character(V900479), 
           abortion_3 = as.character(V923732),
           spendserv_1 = as.character(V900452), 
           spendserv_2 = as.character(V912600), 
           spendserv_3 = as.character(V923701),
           natenvir_1 = as.character(V900377), 
           natenvir_3 = as.character(V923815),
           nataids_1 = as.character(V900379), 
           nataids_3 = as.character(V923727),
           natsoc_1 = as.character(V900380),
           natsoc_3 = as.character(V923811),
           natfood_1 = as.character(V900382), 
           natfood_3 = as.character(V923725),
           natschools_1 = as.character(V900383),
           natschools_3 = as.character(V923818),
           nathome_1 = as.character(V900384),
           nathome_3 = as.character(V923730),
           natchld_1 = as.character(V900385),
           natchld_3 = as.character(V923813),
           defscale_1 = as.character(V900439), 
           defscale_2 = as.character(V912475), 
           defscale_3 = as.character(V923707),
           ftdems_1 = as.character(V900151), 
           ftdems_2 = as.character(V912222), 
           ftdems_3 = as.character(V923317),
           ftreps_1 = as.character(V900152), 
           ftreps_2 = as.character(V912228), 
           ftreps_3 = as.character(V923318),
           ftblacks_1 = as.character(V900155), 
           ftblacks_2 = as.character(V912232), 
           ftblacks_4 = as.character(V925323),
           ftwhites_2 = as.character(V912231), 
           ftwhites_4 = as.character(V925333),
           ftcons_1 = as.character(V900156), 
           ftcons_2 = as.character(V912220), 
           ftcons_4 = as.character(V925319),
           ftlibs_1 = as.character(V900161), 
           ftlibs_2 = as.character(V912226), 
           ftlibs_4 = as.character(V925326),
           ftlabor_1 = as.character(V900157), 
           ftlabor_4 = as.character(V925316),
           fthisp_2 = as.character(V912233), 
           fthisp_4 = as.character(V925327),
           ftfelib_1 = as.character(V900158), 
           ftfelib_2 = as.character(V912239), 
           ftfelib_4 = as.character(V925324),
           eqrole_1 = as.character(V900438),
           eqrole_3 = as.character(V923801),
           crooked_1 = as.character(V900507), 
           crooked_4 = as.character(V926123),
           wastetax_1 = as.character(V900505), 
           wastetax_4 = as.character(V926121),
           trustgov_1 = as.character(V900504), 
           trustgov_2 = as.character(V912487), 
           trustgov_4 = as.character(V926120),
           runfew_1 = as.character(V900506), 
           runfew_2 = as.character(V912488), 
           runfew_4 = as.character(V926122), 
           attentioncpg_1 = as.character(V900062),	
           attentioncpg_3 = as.character(V923101), 
           ppllikeme_1 = as.character(V900509),	
           ppllikeme_2 = as.character(V912489), 
           ppllikeme_4 = as.character(V926102), 
           lessgvt_1 = as.character(V900333), 
           lessgvt_4 = as.character(V925729), 
           prefhiring_1 = as.character(V900463),	
           prefhiring_2 = as.character(V912558), 
           prefhiring_4 = as.character(V925935), 
           cappun_1 = as.character(V900477),	
           cappun_4 = as.character(V925933), 
           letin1a_2 = as.character(V912619),	
           letin1a_4 = as.character(V926235),
           ftasianamericans_2 = as.character(V912235),	
           ftasianamericans_4 = as.character(V925339), 
           ftfeminists_2 = as.character(V912240),
           ftfeminists_4 = as.character(V925317), 
           ftwelfare_1 = as.character(V900159),
           ftwelfare_4 = as.character(V925318), 
           ftenvironmental_2 = as.character(V912230), 
           ftenvironmental_4 = as.character(V925329), 
           ftillimmigrants_2 = as.character(V912234), 
           ftillimmigrants_4 = as.character(V925331), 
           eqoppsuccess_1 = as.character(V900426), 
           eqoppsuccess_4 = as.character(V926024), 
           eqrightstoofar_1 = as.character(V900427),	
           eqrightstoofar_2 = as.character(V912705),	
           eqrightstoofar_4 = as.character(V926025), 
           noteveryonechance_1 = as.character(V900428), 
           noteveryonechance_4 = as.character(V926029), 
           worrylesseq_1 = as.character(V900429),	
           worrylesseq_4 = as.character(V926026), 
           unequalnoprob_1 = as.character(V900430), 
           unequalnoprob_4 = as.character(V926027), 
           equallessprob_2 = as.character(V912703), 
           equallessprob_1 = as.character(V900431),	
           equallessprob_4 = as.character(V926028), 
           moralrel_1 = as.character(V900501),	
           moralrel_2 = as.character(V912702), 
           moralrel_4 = as.character(V926115), 
           tradfamily_1 = as.character(V900502), 
           tradfamily_4 = as.character(V926117), 
           slavediff_1 = as.character(V900523), 
           slavediff_4 = as.character(V926129), 
           wrkwayup_1 = as.character(V900521), 
           wrkwayup_4 = as.character(V926126), 
           matterhrdwrk_1 = as.character(V900522), 
           matterhrdwrk_4 = as.character(V926128), 
           religimp_1 = as.character(V900511), 
           religimp_3 = as.character(V923820),
           complicated_1 = as.character(V900510), 
           complicated_4 = as.character(V926104),
           dontcare_1 = as.character(V900508), 
           dontcare_4 = as.character(V926103)) %>%
    select(c(id, weight_2, weight_3, weight_4, age_1:age_4, date_1:dontcare_4)) %>%
    pivot_longer(weight_2:dontcare_4) %>%
    separate(name, into = c("measure", "wave")) %>%
    spread(measure, value) %>% 
    mutate(date = as.Date(date),
           across(c(weight, abortion:crooked, defscale:wrkwayup),
                  ~as.numeric(.x)),
           partyid = (partyid/6)*100,
           across(c(polviews, jobguar, helpblk,
                    spendserv, defscale, eqrole),
                  ~(.x-1)/6*100),
           trust = (trust-1)*100,
           across(c(stayhome, crooked, wastetax, trustgov, runfew, 
                    attentioncpg, ppllikeme, prefhiring, cappun, 
                    letin1a, eqoppsuccess, eqrightstoofar, noteveryonechance,
                    worrylesseq, unequalnoprob, equallessprob, 
                    moralrel, tradfamily, slavediff, wrkwayup, 
                    matterhrdwrk, religimp,
                    complicated, dontcare),
                  ~(.x-1)/4*100),
           abortion = (abortion - 1)/3*100,
           across(c(natenvir, nataids, natsoc, natfood, natschools,
                    nathome, natchld, lessgvt),
                  ~(.x -1)/2*100)) %>% 
    pivot_longer(c(abortion, attentioncpg:crooked, defscale:wastetax, worrylesseq:wrkwayup)) %>%
    filter(!is.na(age), !is.na(value), !is.na(date)) %>% arrange(id, name, date) %>%
    mutate(df = "1990-92 ANES")
  #Missing specific weights for 
  #wave pairs 90/91. If people have the panel weight
  #they get that wave
  
  return(cleaned)
  
}