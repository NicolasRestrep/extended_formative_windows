
# cleaning/clean_anes_1956_60.R

source("code/cleaning/utils.R")

clean_anes_1956_60 <- function(path) {
  raw <- read_and_zap(path)
  
  cleaned <- raw %>%
    mutate(id = row_number()) %>%
    select(id, V600569, #weight
           V560193, # Interview date 1
           V580309, # Interview date 2
           V600578, # Interview date 3
           V600837, # Interview date 4
           
           V560088, # Party ID 1 
           V580360, # Party ID 2
           V600657, # Party ID 3
           V600835, # Party ID 4 
           
           V560295, # Age 1 
           V580472, # Age 2
           V600688, # Age 3
           
           V560035, V580323, V600622, # stayhome 
           
           V560097, # Pay attention campaign 1
           V580373, # Pay attention campaign 2
           V600664, # Pay attention campaign 3
           
           V560108, # People like me, no say 1
           V600673, # People like me, no say 3
           
           V560111, #so many vote, 1
           V600676, #so many vote, 3
           
           V560112, #pol too complicated 1
           V600677, #pol too complicated 3
           
           V560115, #officials dont care 1
           V600680 #officials dont care 3
    ) %>%
    mutate(weight_4 = as.character(V600569),
           weight_3 = weight_4,
           weight_2 = weight_4,
           across(c(V560088, V580360, V600657, V600835), ~ ifelse(.x %in% c(7, 8, 9), NA, .x)),
           across(c(V560295, V580472, V600688), ~ ifelse(.x > 97, NA, .x)),
           across(c(V560097, V580373, V600664), ~ ifelse(.x %in% c(8,9), NA, .x)), 
           across(c(V560035, V580323, V600622),
                  ~recode(.x, 
                          "1"=1, "2"=1, "3"=1.5, "4"=2, "5"=2, "7"=NA_real_,
                          "0"=NA_real_, "8"=NA_real_, "9"=NA_real_)),
           across(c(V560108, V600673, V560111, V600676, V560112, V600677,
                    V560115, V600680),
                  ~ifelse(.x == 8, 3, ifelse(.x == 9, NA, .x))),
           age_1 = V560295,
           age_2 = V580472,
           age_3 = V600688,
           age_1 = ifelse(is.na(age_1) & age_2 < 98, age_2-2, age_1), 
           age_1 = ifelse(is.na(age_1) & age_3 < 98, age_3-4, age_1),
           age_2 = ifelse(is.na(age_2), age_1 + 2, age_2),
           age_3 = ifelse(is.na(age_3), age_1 + 4, age_3),
           age_1 = as.character(age_1), age_2 = as.character(age_2),
           age_3 = as.character(age_3),
           age_4 = age_3) %>%
    mutate(date_1 = recode(V560193, "10"="1956-11-07", "11"="1956-11-08", "12"="1956-11-09", 
                           "13"="1956-11-10", "14"="1956-11-11", "15"="1956-11-12",
                           "16"="1956-11-13", "20"="1956-11-14", "21"="1956-11-15", 
                           "22"="1956-11-16", "23"="1956-11-17", "24"="1956-11-18",
                           "25"="1956-11-19", "26"="1956-11-20", "30"="1956-11-21", 
                           "31"="1956-11-22", "32"="1956-11-23", "33"="1956-11-24",
                           "34"="1956-11-25", "35"="1956-11-26", "36"="1956-11-27", 
                           "40"="1956-11-28", "41"="1956-11-29", "42"="1956-11-30",
                           "43"="1956-12-01", "44"="1956-12-02", "45"="1956-12-03", 
                           "46"="1956-12-04", "50"="1956-12-05", "51"="1956-12-06",
                           "52"="1956-12-07", "53"="1956-12-08", "54"="1956-12-09", 
                           "55"="1956-12-10", "56"="1956-12-11", "60"="1956-12-12",
                           "61"="1956-12-13", "62"="1956-12-14", "63"="1956-12-15", 
                           "64"="1956-12-16", "65"="1956-12-17", "66"="1956-12-18",
                           "70"="1956-12-19", "71"="1956-12-20", "72"="1956-12-21", 
                           "73"="1956-12-22", "74"="1956-12-23", "75"="1956-12-24",
                           "76"="1956-12-25", "80"="1956-12-26", "81"="1956-12-27", 
                           "82"="1956-12-28", "83"="1956-12-29", "84"="1956-12-30",
                           "85"="1956-12-31", "86"="1957-01-06", "87"="1957-01-07", 
                           "88"="1957-01-08", "89"="1957-01-09", "90"="1957-01-11",
                           "91"="1957-01-12", "92"="1957-01-13", "93"="1957-01-14", 
                           "94"="1957-01-15", "95"="1957-01-16", "96"="1957-01-17",
                           "97"="1957-01-18", "98"="1957-01-19", "99"=NA_character_),
           date_2 = recode(V580309, "1"="1958-11-05", "2"="1958-11-06", "3"="1958-11-07",
                           "4"="1958-11-08", "5"="1958-11-09", "6"="1958-11-10",
                           "7"="1958-11-11", "8"="1958-11-12", "9"="1958-11-13",
                           "10"="1958-11-14", "11"="1958-11-15", "12"="1958-11-16",
                           "13"="1958-11-17", "14"="1958-11-18", "15"="1958-11-19",
                           "16"="1958-11-20", "17"="1958-11-21", "18"="1958-11-22",
                           "19"="1958-11-23", "20"="1958-11-24", "21"="1958-11-25",
                           "22"="1958-11-26", "23"="1958-11-27", "24"="1958-11-28",
                           "25"="1958-11-29", "26"="1958-11-30", "27"="1958-12-01",
                           "28"="1958-12-02", "29"="1958-12-03", "30"="1958-12-04",
                           "31"="1958-12-05", "32"="1958-12-06", "33"="1958-12-07",
                           "34"="1958-12-08", "35"="1958-12-09", "36"="1958-12-10",
                           "37"="1958-12-11", "38"="1958-12-12", "39"="1958-12-13",
                           "40"="1958-12-14", "41"="1958-12-15", "42"="1958-12-16",
                           "43"="1958-12-17", "44"="1958-12-18", "45"="1958-12-19",
                           "46"="1958-12-20", "47"="1958-12-21", "48"="1958-12-22",
                           "49"="1958-12-23", "50"="1958-12-24", "51"="1958-12-25",
                           "99"=NA_character_),
           date_3 = recode(V600578, "1"="1960-09-12", "2"="1960-09-13", "3"="1960-09-14",
                           "4"="1960-09-15", "5"="1960-09-16", "6"="1960-09-17",
                           "7"="1960-09-18", "8"="1960-09-19", "9"="1960-09-20",
                           "10"="1960-09-21", "11"="1960-09-22", "12"="1960-09-23",
                           "13"="1960-09-24", "14"="1960-09-25", "15"="1960-09-26",
                           "16"="1960-09-17", "17"="1960-09-18", "18"="1960-09-19",
                           "19"="1960-09-20", "20"="1960-10-01", "21"="1960-10-02",
                           "22"="1960-10-03", "23"="1960-10-04", "24"="1960-10-05",
                           "25"="1960-10-06", "26"="1960-10-07", "27"="1960-10-08",
                           "28"="1960-10-09", "29"="1960-10-10", "30"="1960-10-11",
                           "31"="1960-10-12", "32"="1960-10-13", "33"="1960-10-14",
                           "34"="1960-10-15", "35"="1960-10-16", "36"="1960-10-17",
                           "37"="1960-10-18", "38"="1960-10-19", "39"="1960-10-20",
                           "40"="1960-10-21", "41"="1960-10-22", "42"="1960-10-23",
                           "43"="1960-10-24", "44"="1960-10-25", "45"="1960-10-26",
                           "46"="1960-10-27", "47"="1960-10-28", "48"="1960-10-29",
                           "49"="1960-10-30", "50"="1960-10-31", "51"="1960-11-01",
                           "52"="1960-11-02", "53"="1960-11-03", "54"="1960-11-04",
                           "55"="1960-11-05", "56"="1960-11-06", "57"="1960-11-07",
                           "99"=NA_character_),
           date_4 = recode(V600837, "9"="1960-11-09", "10"="1960-11-10", "11"="1960-11-11",
                           "12"="1960-11-12", "13"="1960-11-13", "14"="1960-11-14",
                           "15"="1960-11-15", "16"="1960-11-16", "17"="1960-11-17",
                           "18"="1960-11-18", "19"="1960-11-19", "20"="1960-11-20",
                           "21"="1960-11-21", "22"="1960-11-22", "23"="1960-11-23",
                           "24"="1960-11-24", "25"="1960-11-25", "26"="1960-11-26",
                           "27"="1960-11-27", "28"="1960-11-28", "29"="1960-11-29",
                           "30"="1960-11-30", "31"="1960-12-01", "32"="1960-12-02",
                           "33"="1960-12-03", "34"="1960-12-04", "35"="1960-12-05",
                           "36"="1960-12-06", "37"="1960-12-07", "38"="1960-12-08",
                           "39"="1960-12-09", "40"="1960-12-10", "41"="1960-12-11",
                           "42"="1960-12-12", "43"="1960-12-13", "44"="1960-12-14",
                           "45"="1960-12-15", "46"="1960-12-16", "47"="1960-12-17",
                           "48"="1960-12-18", "49"="1960-12-19", "50"="1960-12-20",
                           "51"="1960-12-21", "52"="1960-12-22", "53"="1960-12-23",
                           "54"="1960-12-24", "55"="1960-12-25", "56"="1960-12-26",
                           "0"=NA_character_),
           partyid_1 = as.character(V560088), 
           partyid_2 = as.character(V580360), 
           partyid_3 = as.character(V600657), 
           partyid_4 = as.character(V600835),
           stayhome_1 = as.character(V560035), 
           stayhome_2 = as.character(V580323), 
           stayhome_3 = as.character(V600622),
           attentioncpg_1 = as.character(V560097), 
           attentioncpg_2 = as.character(V580373), 
           attentioncpg_3 = as.character(V600664), 
           ppllikeme_1 = as.character(V560108), 
           ppllikeme_3 = as.character(V600673),
           manyvote_1 = as.character(V560111), #so many vote, 1
           manyvote_3 = as.character(V600676), #so many vote, 3
           complicated_1 = as.character(V560112), #pol too complicated 1
           complicated_3 = as.character(V600677), #pol too complicated 3
           dontcare_1 = as.character(V560115), #officials dont care 1
           dontcare_3 = as.character(V600680) #officials dont care 3
    ) %>%
    select(id, weight_2, weight_3, weight_4, age_1:date_4, partyid_1:dontcare_3) %>% 
    pivot_longer(weight_2:dontcare_3) %>%
    separate(name, into = c("measure", "wave")) %>%
    spread(measure, value) %>% 
    mutate(date = as.Date(date),
           across(c(weight, age, attentioncpg:complicated, dontcare:stayhome),
                  ~as.numeric(.x)),
           partyid = (partyid/6)*100,
           stayhome = (stayhome-1)*100,
           across(c(attentioncpg, ppllikeme, complicated,
                    dontcare, manyvote), 
                  ~(.x-1)/4*100)) %>%
    pivot_longer(c(attentioncpg:complicated, dontcare:stayhome)) %>%
    filter(!is.na(age), !is.na(value), !is.na(date)) %>% arrange(id, name, date) %>%
    mutate(df = "1956–60 ANES")
  
  return(cleaned)
}


