
# cleaning/clean_anes_92_97.R

source("code/cleaning/utils.R")

clean_anes_92_97 <- function(path) {
  
  anes92 <- read_and_zap(path)
  
  cleaned <- anes92 %>%
    mutate(id = row_number()) %>%
    select(id, 
           V923008a, V923008b, V940006a, 
           V960005a, V960005b,#weights
           V923903, V941203, V960605, 
           V923026, V923027, V925005, V925006, V937014, V937015, 
           V940033, V940034, V952360, V960012, V960011, V960903, V960902,
           V970367,
           V923634, V937370, V940655, V952263a, V960420, V970106, #partyid
           V923509, V937204, V940839, V952253, V960365, V961269, V970302, #polviews
           V926139, V960567, V961258, V970011, #trust
           V923604, V941019, V960410, #stayhome
           V923718, V940930, V960483, #jobguar
           V923716, V940950, V960479, #govins
           V923724, V940936, V960487, V961210, V970193, #helpblk
           V923732, V941014, V960503, #abortion
           V923701, V940940, V960450, V970096, #spendserv
           V923815, V940817, V960561, #environment
           V923727, V940821, V960498, #aids
           V923811, V940819, V960560, #socsec
           V923725, V940822, V960496, #schools
           V923818, V940823, V960562, #food stamps
           V923730, V960501, #homeless
           V923813, V940824, V960564, #child care
           V923726, V940820, V960497, #welfare
           V923814, V940825, V960563,
           V923707, V940929, V960463,
           V923317, V937141, V940301, V960292,
           V923318, V937142, V940302, V960293,
           V925323, V940305, V961029, V970040,
           V925333, V940313, V961030, V970041, 
           V925319, V940306, V961031,
           V925326, V940311, V961032,
           V925322, V940314, V952115, V961034, V970056,
           V925316, V940307, V961033, V970055,
           V925328, V937146, V961027,
           V925327, V940304, V961037, V970042,
           V925335, V937145, V940318, V961042, V970054,
           V940312, V961035, 
           V925324, V940308, V961039,
           V960569, V961259, V970012,
           V923801, V940928, V960543, V970230,
           V926123, V941036, V961254,
           V926121, V941034, V961252,	V970321,
           V926120, V941033, V960566, V961251, V970013,
           V926122, V941035, V961253, 
           # Attention Pol campaigns, 
           V923101, V940124, V960201, 
           # People like me 
           V926102,	V941038, V960568, V961245, V970014, 
           # Spending poor people
           V923817, V960565, 
           # Less Government 
           V925729, V961144, 
           # Preferential Hiring 
           V925935,	V937405, V941001, V961208, 
           # Favor Death Penalty 
           V925933, V941041, V961197, 
           # Immigrant number 
           V926235, V941016, V961325, 
           # Opose homo
           V925923, V937324, V961193, 
           # T: Feminists 
           V925317, V970053, 
           # T: Welfare
           V925318, V940309, V961036,	V970057, 
           # T: Environmental
           V925329,	V940310, V961041, 
           # T: Illegal Immigrants
           V925331, V940317, 
           # Equal Opportunity Success
           V926024,	V940914, V961229, 
           # Equal rights too far 
           V926025,	V940915, V961230, 
           # Not everyone given a chance 
           V926029,	V940916, V961231, 
           # Worry less equality 
           V926026, V940917, V961232, 
           # Unequal no problem
           V926027,	V940918, V961233, 
           # More equality less problem
           V926028, V940919, V961234, 
           # Moral relativity 
           V926115, V941030, V961248, 
           # Traditional Familiy values
           V926117, V941031, V961249, 
           # Hrd work lazy whites
           V926221, V961311, 
           # Hrd work lazy blacks 
           V926222, V961312, 
           # Slave difficulty 
           V926129, V941051, 
           # Black no favors 
           V926126, V941049, V970182, 
           # Matter hard work
           V926128,	V941050, V970181, 
           # Religious important
           V923820, V941043, V960571,
           # Complicated (2,4,7; 5-pt; 0,9 - NA, 8 - 3)
           V926104, V941039, V961246,
           # Dontcare (2,4,7; 0,9 - NA, 8 - 3)
           V926103, V941037, V961244,
           # Pay attention (2,7 - 0,8,9 - NA)
           V926125, V961256,
           # Elections matter (2,7 - 0,8,9 - NA)
           V926124, V961255,
           # Satisfied democracy(5,7; NA - 0,8,9)
           V952119, V961459
    ) %>%
    zap_labels() %>%
    mutate(weight_1 = as.character(V923008a), 
           weight_2 = as.character(V923008b), 
           weight_3 = weight_2,
           weight_4 = as.character(V940006a), 
           weight_5 = weight_4,
           weight_6 = as.character(V960005a), 
           weight_7 = as.character(V960005b),
           weight_8 = weight_7) %>%
    mutate(across(c(V923903, V941203, V960605),
                  ~ifelse(.x < 0 | .x > 95, NA, .x)),
           age_1 = ifelse(is.na(V923903) & !is.na(V941203), V941203 - 2, V923903),
           age_1 = ifelse(is.na(V923903) & !is.na(V960605), V960605 - 4, V923903),
           age_2 = age_1,
           age_3 = age_1 + 1,
           age_4 = ifelse(is.na(V941203), age_1 + 2, V941203),
           age_5 = age_4 + 1,
           age_6 = ifelse(is.na(V960605), age_1 + 4, V960605),
           age_7 = age_6,
           age_8 = age_7 + 1,
           across(age_1:age_8, ~as.character(.x))) %>%
    mutate(date_1 = paste(1992, sprintf("%02d", V923026), sprintf("%02d", V923027), sep = "-"),
           date_1 = ifelse(date_1 == "1992-NA-NA", NA, date_1),
           year = ifelse(V925005 %in% 1, 1993, 1992),
           date_2 = paste(year, sprintf("%02d", V925005), sprintf("%02d", V925006), sep = "-"),
           date_2 = ifelse(date_2 %in% c("1992-NA-NA"), NA, date_2),
           date_3 = paste(1993, sprintf("%02d", V937014), sprintf("%02d", V937015), sep = "-"),
           date_3 = ifelse(date_3 %in% c("1992-00-00", "1993-NA-NA"), NA, date_3),
           year = ifelse(V940033 == 1, 1995, 1994),
           date_4 = paste(year, sprintf("%02d", V940033), sprintf("%02d", V940034), sep = "-"),
           date_4 = ifelse(date_4 == "NA-NA-NA", NA, date_4),
           date_5 = paste(substr(V952360, 1, 4),substr(V952360, 5, 6),substr(V952360, 7, 8),
                          sep = "-"),
           date_5 = ifelse(date_5 %in% c("NA-NA-NA", "1e+0-8-"), NA, date_5),
           date_6 = paste(1996, sprintf("%02d", V960012), sprintf("%02d", V960011), sep = "-"),
           date_6 = ifelse(date_6 %in% c("1996-NA-NA"), NA, date_6),
           year = ifelse(V960903 == 1, 1997, 1996),
           date_7 = paste(year, sprintf("%02d", V960903), sprintf("%02d", V960902), sep = "-"),
           date_7 = ifelse(date_7 %in% c("NA-NA-NA", "1996-00-00"), NA, date_7),
           dm = sprintf("%04d", V970367),
           date_8 = paste(1997 ,substr(dm, 1, 2),substr(dm, 3, 4),
                          sep = "-"),
           date_8 = ifelse(date_8 %in% c("1997-00-NA"), NA, date_8),
           #Nat____ questions coded differently in different wave
           across(c(V960561, V960498, V960560, V960496,
                    V960562, V960501, V960564, V960497,
                    V960563, V960565), 
                  ~recode(.x, "1"=1, "2"=3, "3"=2, "7"=3,
                          "8"=NA_real_, "9"=NA_real_)),
           across(c(V961254, V961252,	V970321),
                  ~recode(.x, "1"=5, "5"=1, "5"=3,
                          "8"=NA_real_, "9"=NA_real_, "0"=NA_real_)),
           V960566 = recode(V960566, "1"=1, "2"=3, "3"=5, "7"=5,
                            "8"=NA_real_, "9"=NA_real_),
           V961251 = recode(V961251, "1"=1, "2"=3, "3"=5, 
                            "4"=7, "8"=NA_real_, "9"=NA_real_,
                            "0"=NA_real_),
           across(c(V926120, V941033, V960566, V961251, V970013),
                  ~ifelse(.x == 7, 5, .x)),
           V961253 = recode(V961253, "1"=5, "5"=1, "0"=0, "8"=8, "9"=9),
           across(c(V923634, V937370, V940655, V952263a, V960420, V970106, 
                    V923101, V940124, V960201, 
                    V923817, V960565),
                  ~ifelse(.x %in% c(7,8,9), NA, .x)),
           V960571 = ifelse(V960571 == 2, 5, V960571),
           across(c(V923509, V937204, V940839, V952253, V960365, V961269, V970302,
                    V926139, V960567, V961258, V970011,
                    V923604, V941019, V960410,
                    V923718, V940930, V960483,
                    V923716, V940950, V960479,
                    V923724, V940936, V960487, V961210, V970193,
                    V923701, V940940, V960450, V970096,
                    V923707, V940929, V960463,
                    V960569, V961259, V970012,
                    V923801, V940928, V960543, V970230,
                    V926123, V941036, V961254,
                    V926121, V941034, V961252,	V970321,
                    V926120, V941033, V960566, V961251, V970013,
                    V926122, V941035, V961253, 
                    V925729, V961144, 
                    V925933, V941041, V961197, 
                    V926235, V941016, V961325, 
                    V925923, V937324, V961193, 
                    V926024, V940914, V961229, 
                    V926025, V940915,	V961230, 
                    V926029, V940916, V961231, 
                    V926026, V940917, V961232, 
                    V926027, V940918, V961233, 
                    V926028, V940919, V961234, 
                    V926115, V941030,	V961248, 
                    V926117, V941031,	V961249, 
                    V926221, V961311, 
                    V926222, V961312, 
                    V926129, V941051, 
                    V926126, V941049, V970182, 
                    V926128, V941050,	V970181, 
                    V923820, V941043, V960571,
                    V926125, V961256,
                    V926124, V961255,
                    V952119, V961459), 
                  ~ifelse(.x %in% c(0,8,9, 96), NA, .x)),
           across(c(V926104, V941039, V961246,
                    V926103, V941037, V961244,
                    V926102, V941038, V960568, V961245, V970014),
                  ~recode(.x, "1"=1, "2"=1, "3"=3, "4"=5, "5"=5, 
                          "0"=NA_real_, "9"=NA_real_, "8"=3)),
           across(c(V923820, V941043), ~ ifelse(.x == 2, 5, .x)),
           across(c(V925935, V937405, V941001, V961208),
                  ~ifelse(.x %in% c(0,7,8,9), NA, .x)),
           across(c(V923732, V941014, V960503),
                  ~ifelse(.x %in% c(6,7,8,9), NA, .x)),
           across(c(V923815, V940817, V960561,
                    V923727, V940821, V960498,
                    V923811, V940819, V960560,
                    V923725, V940822, V960496,
                    V923818, V940823, V960562,
                    V923730, V960501,
                    V923813, V940824, V960564, 
                    V923726, V940820, V960497, #welfare
                    V923814, V940825, V960563,
                    V923817),
                  ~ifelse(.x == 7, 3, ifelse(.x > 7, NA, .x))),
           across(c(V961258, V970011,
                    V961259, V970012), ~ifelse(.x == 5, 2, .x)),
           across(c(#democrats 997/998/999/888/996
             V923317, V937141, V940301, V960292,
             V923318, V937142, V940302, V960293,
             V925323, V940305, V961029, V970040,
             V925333, V940313, V961030, V970041, 
             V925319, V940306, V961031,
             V925326, V940311, V961032,
             V925322, V940314, V952115, V961034, V970056,
             V925316, V940307, V961033, V970055,
             V925328, V937146, V961027,
             V925327, V940304, V961037, V970042,
             V925335, V937145, V940318, V961042, V970054,
             V940312, V961035, 
             V925324, V940308, V961039, 
             V925317, V970053, 
             V925318, V940309, V961036,	V970057, 
             V925329, V940310, V961041, 
             V925331,	V940317),
             ~ifelse(.x %in% c(997,998,999,888,996), NA, .x)),
           partyid_1 = as.character(V923634),
           partyid_3 = as.character(V937370),
           partyid_4 = as.character(V940655),
           partyid_5 = as.character(V952263a),
           partyid_6 = as.character(V960420),
           partyid_8 = as.character(V970106),
           polviews_1 = as.character(V923509),
           polviews_3 = as.character(V937204),
           polviews_4 = as.character(V940839),
           polviews_5 = as.character(V952253),
           polviews_6 = as.character(V960365),
           polviews_7 = as.character(V961269),
           polviews_8 = as.character(V970302),
           trust_2 = as.character(V926139),
           trust_6 = as.character(V960567),
           trust_7 = as.character(V961258),
           trust_8 = as.character(V970011),
           stayhome_1 = as.character(V923604), 
           stayhome_4 = as.character(V941019), 
           stayhome_6 = as.character(V960410),
           jobguar_1 = as.character(V923718), 
           jobguar_4 = as.character(V940930), 
           jobguar_6 = as.character(V960483),
           govins_1 = as.character(V923716), 
           govins_4 = as.character(V940950), 
           govins_6 = as.character(V960479),
           helpblk_1 = as.character(V923724),
           helpblk_4 = as.character(V940936), 
           helpblk_6 = as.character(V960487), 
           helpblk_7 = as.character(V961210), 
           helpblk_8 = as.character(V970193),
           abortion_1 = as.character(V923732), 
           abortion_4 = as.character(V941014), 
           abortion_6 = as.character(V960503),
           spendserv_1 = as.character(V923701), 
           spendserv_4 = as.character(V940940), 
           spendserv_6 = as.character(V960450), 
           spendserv_8 = as.character(V970096),
           natenvir_1 = as.character(V923815), 
           natenvir_4 = as.character(V940817), 
           natenvir_6 = as.character(V960561),
           nataids_1 = as.character(V923727), 
           nataids_4 = as.character(V940821), 
           nataids_6 = as.character(V960498),
           natsoc_1 = as.character(V923811), 
           natsoc_4 = as.character(V940819), 
           natsoc_6 = as.character(V960560),
           natfood_1 = as.character(V923725), 
           natfood_4 = as.character(V940822), 
           natfood_6 = as.character(V960496),
           natschools_1 = as.character(V923818), 
           natschools_4 = as.character(V940823), 
           natschools_6 = as.character(V960562),
           nathome_1 = as.character(V923730), 
           nathome_6 = as.character(V960501),
           natchld_1 = as.character(V923813), 
           natchld_4 = as.character(V940824), 
           natchld_6 = as.character(V960564),
           natfare_1 = as.character(V923726), 
           natfare_4 = as.character(V940820), 
           natfare_6 = as.character(V960497),
           natcrime_1 = as.character(V923814), 
           natcrime_4 = as.character(V940825), 
           natcrime_6 = as.character(V960563),
           defscale_1 = as.character(V923707), 
           defscale_4 = as.character(V940929), 
           defscale_6 = as.character(V960463),
           ftdems_1 = as.character(V923317), 
           ftdems_3 = as.character(V937141), 
           ftdems_4 = as.character(V940301), 
           ftdems_6 = as.character(V960292),
           ftreps_1 = as.character(V923318), 
           ftreps_3 = as.character(V937142), 
           ftreps_4 = as.character(V940302), 
           ftreps_6 = as.character(V960293),
           ftblacks_2 = as.character(V925323), 
           ftblacks_4 = as.character(V940305), 
           ftblacks_7 = as.character(V961029), 
           ftblacks_8 = as.character(V970040),
           ftwhites_2 = as.character(V925333), 
           ftwhites_4 = as.character(V940313), 
           ftwhites_7 = as.character(V961030), 
           ftwhites_8 = as.character(V970041), 
           ftcons_2 = as.character(V925319), 
           ftcons_4 = as.character(V940306), 
           ftcons_7 = as.character(V961031),
           ftlibs_2 = as.character(V925326), 
           ftlibs_4 = as.character(V940311), 
           ftlibs_7 = as.character(V961032),
           ftbiz_2 = as.character(V925322), 
           ftbiz_4 = as.character(V940314), 
           ftbiz_5 = as.character(V952115), 
           ftbiz_7 = as.character(V961034), 
           ftbiz_8 = as.character(V970056),
           ftlabor_2 = as.character(V925316), 
           ftlabor_4 = as.character(V940307), 
           ftlabor_7 = as.character(V961033), 
           ftlabor_8 = as.character(V970055),
           ftmil_2 = as.character(V925328), 
           ftmil_3 = as.character(V937146), 
           ftmil_7 = as.character(V961027),
           fthisp_2 = as.character(V925327), 
           fthisp_4 = as.character(V940304), 
           fthisp_7 = as.character(V961037), 
           fthisp_8 = as.character(V970042),
           fthomo_2 = as.character(V925335), 
           fthomo_3 = as.character(V937145), 
           fthomo_4 = as.character(V940318), 
           fthomo_7 = as.character(V961042), 
           fthomo_8 = as.character(V970054),
           ftpoor_4 = as.character(V940312), 
           ftpoor_7 = as.character(V961035), 
           ftfelib_2 = as.character(V925324), 
           ftfelib_4 = as.character(V940308), 
           ftfelib_7 = as.character(V961039),
           fair_6 = as.character(V960569), 
           fair_7 = as.character(V961259), 
           fair_8 = as.character(V970012),
           eqrole_1 = as.character(V923801), 
           eqrole_4 = as.character(V940928), 
           eqrole_6 = as.character(V960543), 
           eqrole_8 = as.character(V970230),
           crooked_2 = as.character(V926123), 
           crooked_4 = as.character(V941036), 
           crooked_7 = as.character(V961254),
           wastetax_2 = as.character(V926121), 
           wastetax_4 = as.character(V941034), 
           wastetax_7 = as.character(V961252),
           wastetax_8 = as.character(V970321),
           trustgov_2 = as.character(V926120), 
           trustgov_4 = as.character(V941033), 
           trustgov_6 = as.character(V960566), 
           trustgov_7 = as.character(V961251), 
           trustgov_8 = as.character(V970013),
           #runfew (1 - all; 5 = big, NA: 0,8,9);
           runfew_2 = as.character(V926122), 
           runfew_4 = as.character(V941035), 
           runfew_7 = as.character(V961253), 
           attentioncpg_1 = as.character(V923101), 
           attentioncpg_4 = as.character(V940124), 
           attentioncpg_6 = as.character(V960201), 
           ppllikeme_2 = as.character(V926102),
           ppllikeme_4 =	as.character(V941038), 
           ppllikeme_6 = as.character(V960568), 
           ppllikeme_7 = as.character(V961245), 
           ppllikeme_8 = as.character(V970014), 
           natpoor_1 = as.character(V923817), 
           natpoor_6 = as.character(V960565), 
           lessgvt_2 = as.character(V925729), 
           lessgvt_7 = as.character(V961144), 
           prefhiring_2 = as.character(V925935),
           prefhiring_3 = as.character(V937405), 
           prefhiring_4 = as.character(V941001), 
           prefhiring_7 = as.character(V961208), 
           cappun_2 = as.character(V925933), 
           cappun_4 = as.character(V941041), 
           cappun_7 = as.character(V961197), 
           letin1a_2 = as.character(V926235), 
           letin1a_4 = as.character(V941016), 
           letin1a_7 = as.character(V961325), 
           opposehomo_2 = as.character(V925923), 
           opposehomo_3 = as.character(V937324), 
           opposehomo_7 = as.character(V961193), 
           ftfeminists_1 = as.character(V925317), 
           ftfeminists_8 = as.character(V970053), 
           ftwelfare_2 = as.character(V925318), 
           ftwelfare_4 = as.character(V940309), 
           ftwelfare_7 = as.character(V961036),	
           ftwelfare_8 = as.character(V970057), 
           ftenvironmental_2 = as.character(V925329),
           ftenvironmental_4 = as.character(V940310), 
           ftenvironmental_7 = as.character(V961041), 
           ftillimmigrants_2 = as.character(V925331), 
           ftillimmigrants_4 = as.character(V940317), 
           eqoppsuccess_2 = as.character(V926024),
           eqoppsuccess_4 = as.character(V940914),
           eqoppsuccess_7 = as.character(V961229), 
           eqrightstoofar_2 = as.character(V926025),	
           eqrightstoofar_4 = as.character(V940915), 
           eqrightstoofar_7 = as.character(V961230), 
           noteveryonechance_2 = as.character(V926029),
           noteveryonechance_4 = as.character(V940916), 
           noteveryonechance_7 = as.character(V961231), 
           worrylesseq_2 = as.character(V926026), 
           worrylesseq_4 = as.character(V940917), 
           worrylesseq_7 = as.character(V961232), 
           unequalnoprob_2 = as.character(V926027), 
           unequalnoprob_4 = as.character(V940918), 
           unequalnoprob_7 = as.character(V961233), 
           equallessprob_2 = as.character(V926028),
           equallessprob_4 = as.character(V940919), 
           equallessprob_7 = as.character(V961234), 
           moralrel_2 = as.character(V926115), 
           moralrel_4 = as.character(V941030),
           moralrel_7 = as.character(V961248),
           tradfamily_2 = as.character(V926117), 
           tradfamily_4 = as.character(V941031), 
           tradfamily_7 = as.character(V961249), 
           hrdwrklazywhite_2 = as.character(V926221), 
           hrdwrklazywhite_7 = as.character(V961311), 
           hrdwrklazyblack_2 = as.character(V926222), 
           hrdwrklazyblack_7 = as.character(V961312), 
           slavediff_2 = as.character(V926129), 
           slavediff_4 = as.character(V941051),
           wrkwayup_2 = as.character(V926126), 
           wrkwayup_4 = as.character(V941049), 
           wrkwayup_8 = as.character(V970182), 
           matterhrdwrk_2 = as.character(V926128), 
           matterhrdwrk_4 = as.character(V941050), 
           matterhrdwrk_8 = as.character(V970181), 
           religimp_1 = as.character(V923820), 
           religimp_4 = as.character(V941043), 
           religimp_6 = as.character(V960571),
           # Complicated (2,4,7; 5-pt; 0,9 - NA, 8 - 3)
           complicated_2 = as.character(V926104), 
           complicated_4 = as.character(V941039), 
           complicated_7 = as.character(V961246),
           # Dontcare (2,4,7; 0,9 - NA, 8 - 3)
           dontcare_2 = as.character(V926103), 
           dontcare_4 = as.character(V941037), 
           dontcare_7 = as.character(V961244),
           # Pay attention (2,7 - 0,8,9 - NA)
           polattn_2 = as.character(V926125), 
           polattn_7 = as.character(V961256),
           # Elections matter (2,7 - 0,8,9 - NA)
           elexmatter_2 = as.character(V926124), 
           elexmatter_7 = as.character(V961255),
           satdemo_5 = as.character(V952119), 
           satdemo_7 = as.character(V961459)
    ) %>%
    select(c(id, weight_1:weight_8, age_1:age_8, date_1, date_2:date_7, date_8:satdemo_7)) %>%
    pivot_longer(weight_1:satdemo_7) %>%
    separate(name, into = c("measure", "wave")) %>%
    spread(measure, value) %>%
    mutate(date = as.Date(date),
           across(c(abortion:crooked, defscale:wrkwayup),
                  ~as.numeric(.x)),
           partyid = (partyid/6)*100,
           across(c(polviews, jobguar, govins, helpblk,
                    spendserv, defscale, eqrole, hrdwrklazywhite, 
                    hrdwrklazyblack),
                  ~(.x - 1)/6*100),
           across(c(trust, fair),
                  ~(.x-1)*100),
           across(c(stayhome, crooked, wastetax, trustgov, runfew, 
                    attentioncpg, ppllikeme, prefhiring, cappun, 
                    letin1a, opposehomo, eqoppsuccess, eqrightstoofar, 
                    noteveryonechance, worrylesseq, unequalnoprob, equallessprob, moralrel,
                    tradfamily, slavediff, wrkwayup, matterhrdwrk, religimp,
                    complicated, dontcare, polattn, elexmatter),
                  ~(.x - 1)/4*100),
           across(c(abortion, satdemo),
                  ~(.x - 1)/3*100),
           across(c(natenvir, nataids, natsoc, natfood, natschools,
                    nathome, natchld, natfare, natcrime, natpoor, 
                    lessgvt),
                  ~(.x - 1)/2*100)) %>% 
    pivot_longer(c(abortion, attentioncpg:crooked, defscale:wastetax, worrylesseq:wrkwayup)) %>%
    filter(!is.na(age), !is.na(value), !is.na(date)) %>% arrange(id, name, date) %>%
    mutate(df = "1992-97 ANES")
  
  return(cleaned)
}