
# cleaning/clean_anes_00_04.R

source("code/cleaning/utils.R")


clean_anes_00_04 <- function(path) {
  
  anes00 <- read_and_zap(path)
  
  cleaned <- anes00 %>%
    mutate(id = row_number()) %>%
    select(id, 
           WT00PRE, WT00PO, WT02PRE, WT02PO, WT04,
           M000908,M023126X,M045193,
           M000008, M000130, M022012C, M024012C, M044013b,
           M000523, M023038X, M045058x,
           M000446, M001368, M023022,
           M001475, M025101, M045158,
           M001477, M025103, M045160,
           M001476, M025102, M045159, 
           M000513a, M023033, M045143,
           M000694, M001403, M045110,
           M000545, M001385, M045127,
           M000682, M023052, M025113, M045068,
           M000678, M023054, M025116, M045076,
           M000677, M023045, M025106, M045069, #aids
           M000681, M023055, M025117, M045077, #socsec
           M000683, M023047A, M025108A, M045071a, #schools
           M000685, M023049, M025109, M045073,
           M000676, M023046, M025107, M045070,
           M000684, M023048, M025109, M045072,
           M001308, M025055, M045023,
           M001309, M025056, M045024,
           M001310, M025057, M045025,
           M001311, M025058, M045026,
           M001313, M025060, M045028,
           M001312, M025059, M045027,
           M001306, M025053, M045021,
           M001316, M025063, M045031,
           M001321, M025067, M045035,
           M001314, M025061, M045029,
           M001323, M025068, M045036,
           M001324, M025069, M045037,
           M001537, M025177, M045152, #crooked
           M001535, M025175, M045150, #wastetax
           M001534, M025174, M045149, #trustgov
           M001536, M025176, M045151,#runfew
           # Attention political
           M000301,	M001201, M023001,	M025001, 
           # People like me 
           M001528,	M025173, M045148, 
           # Spend poor ppl
           M000680, M023053A,	M025115A,	M045075a, 
           # Spend military
           M025105,	M045081, 
           # Spend aid to blacks
           M000687, M023057, M025119,	M045079,
           # Immigrant number
           M000510, M045109, 
           # Favor or oppose laws around homosexuals
           M001478, M045111, 
           # Pay more or less taxes 
           M023069, M025141, M045119, 
           # T: asian-americans
           M001327, M025072, M045040, 
           # T: feminists
           M001326, M025071, M045039, 
           # T: welfare 
           M001315, M025062, M045030, 
           # T: environmentalists
           M001320, M025066, M045034, 
           # Religion important 
           M000872, M023082, M045173,
           # Many vote (2,4,5: 5pt; NA:0,9, 8-3)
           M001520, M025171, M045146,
           # Pol dont care (2,4,5; 5 pt; NA: 0,9; 8-3)
           M001527, M025172, M045147,
           # elections matter (2,4,5; 5 pt, NA: 0,8,9)
           M001538, M025178, M045153,
           # satisfied with democracy
           M001651, M025179, M045154
    ) %>%
    zap_labels() %>%
    mutate(weight_1 = as.character(WT00PRE), 
           weight_2 = as.character(WT00PO), 
           weight_3 = as.character(WT02PRE), 
           weight_4 = as.character(WT02PO), 
           weight_5 = as.character(WT04)) %>%
    mutate(age_1 = ifelse(is.na(M000908) & !is.na(M023126X), M023126X - 2, M000908),
           age_1 = ifelse(is.na(M000908) & !is.na(M045193), M045193 - 4, M000908),
           age_2 = age_1,
           age_3 = ifelse(is.na(M023126X), age_1 + 2, M023126X),
           age_4 = age_3,
           age_5 = ifelse(is.na(M045193), age_1 + 4, M045193),
           across(age_1:age_5, ~as.character(.x))) %>%
    mutate(date_1 = paste(2000,substr(M000008, 1, 2),substr(M000008, 3, 4),
                          sep = "-"),
           date_2 = paste(2000,substr(M000130, 1, 2),substr(M000130, 3, 4),
                          sep = "-"),
           date_2 = ifelse(date_2 %in% c("2000-00-00"), NA, date_2),
           date_3 = paste(2002,substr(M022012C, 1, 2),substr(M022012C, 3, 4),
                          sep = "-"),
           date_3 = ifelse(date_3 == "2002--", NA, date_3),
           date_4 = paste(2002,substr(M024012C, 1, 2),substr(M024012C, 3, 4),
                          sep = "-"),
           date_4 = ifelse(date_4 == "2002--", NA, date_4),
           date_5 = paste(2004,substr(M044013b, 1, 2),substr(M044013b, 3, 4),
                          sep = "-"),
           date_5 = ifelse(date_5 == "2004--", NA, date_5),
           across(c(M001534, M025174, M045149),
                  ~ifelse(.x == 4, 3, .x)),
           across(c(M000682, M000678, M000677, M000681, 
                    M000683, M000685, M000676, M000684,
                    M000680, M000687), 
                  ~recode(.x, "1"=1, "5"=2, "3"=3, "7"=3,
                          "8"=NA_real_, "9"=NA_real_, "0"=NA_real_)),
           across(c(M023052, M025113, M045068,
                    M023054, M025116, M045076,
                    M023045, M025106, M045069,
                    M023055, M025117, M045077,
                    M023047A, M025108A, M045071a,
                    M023049, M025109, M045073, 
                    M023046, M025107, M045070, 
                    M023048, M025109, M045072,
                    M023053A, M025115A, M045075a,
                    M023057, M025119,	M045079,
                    M025105, M045081),
                  ~recode(.x, "1"=1, "2"=3, "3"=2,
                          "4"=3)),
           across(c(M000523, M023038X, M045058x), 
                  ~ifelse(.x %in% c(7,8,9), NA, .x)),
           across(c(M001520, M025171, M045146,
                    M001527, M025172, M045147,
                    M001528,	M025173, M045148),
                  ~recode(.x, "1"=1, "2"=1, "3"=3, "4"=5, "5"=5, 
                          "0"=NA_real_, "9"=NA_real_, "8"=3)),
           across(c(M000446, M001368, M023022,
                    M001538, M025178, M045153), 
                  ~ifelse(.x %in% c(0,8,9,90), NA, .x)),
           across(c(M001475, M025101, M045158,
                    M000513a, M023033, M045143,
                    M000545, M001385, M045127,
                    M001477, M025103, M045160,
                    M001476, M025102, M045159,
                    M001537, M025177, M045152,
                    M001535, M025175, M045150,
                    M001534, M025174, M045149,
                    M001536, M025176, M045151, 
                    M000301,	M001201, M023001,	M025001, 
                    M000510, M045109, 
                    M001478, M045111, 
                    M000872, M023082, M045173,
                    M001651, M025179, M045154), 
                  ~ifelse(.x %in% c(0,8,9), NA, .x)),
           across(c(M000694, M001403, M045110, 
                    M023069, M025141, M045119),
                  ~ifelse(.x %in% c(0,7,8,9), NA, .x)),
           across(c(
             M001308, M025055, M045023,
             M001309, M025056, M045024,
             M001310, M025057, M045025,
             M001311, M025058, M045026,
             M001313, M025060, M045028,
             M001312, M025059, M045027,
             M001306, M025053, M045021,
             M001316, M025063, M045031,
             M001321, M025067, M045035,
             M001314, M025061, M045029,
             M001323, M025068, M045036,
             M001324, M025069, M045037, 
             M001327, M025072, M045040, 
             M001326, M025071, M045039, 
             M001315, M025062, M045030, 
             M001320, M025066, M045034),
             ~ifelse(.x > 100, NA, .x)),
           partyid_1 = as.character(M000523),
           partyid_3 = as.character(M023038X),
           partyid_5 = as.character(M045058x),
           polviews_1 = as.character(M000446),
           polviews_2 = as.character(M001368),
           polviews_3 = as.character(M023022),
           trust_2 = as.character(M001475),
           trust_4 = as.character(M025101),
           trust_5 = as.character(M045158),
           helpful_2 = as.character(M001477), 
           helpful_4 = as.character(M025103), 
           helpful_5 = as.character(M045160),
           fair_2 = as.character(M001476), 
           fair_4 = as.character(M025102), 
           fair_5 = as.character(M045159),
           stayhome_1 = as.character(M000513a), 
           stayhome_3 = as.character(M023033), 
           stayhome_5 = as.character(M045143),
           abortion_1 = as.character(M000694), 
           abortion_2 = as.character(M001403), 
           abortion_5 = as.character(M045110),
           spendserv_1 = as.character(M000545), 
           spendserv_2 = as.character(M001385), 
           spendserv_5 = as.character(M045127),
           natenvir_1 = as.character(M000682), 
           natenvir_3 = as.character(M023052), 
           natenvir_4 = as.character(M025113), 
           natenvir_5 = as.character(M045068),
           nataid_1 = as.character(M000678), 
           nataid_3 = as.character(M023054), 
           nataid_4 = as.character(M025116), 
           nataid_5 = as.character(M045076),
           nataids_1 = as.character(M000677), 
           nataids_3 = as.character(M023045), 
           nataids_4 = as.character(M025106), 
           nataids_5 = as.character(M045069),
           natsoc_1 = as.character(M000681), 
           natsoc_3 = as.character(M023055), 
           natsoc_4 = as.character(M025117), 
           natsoc_5 = as.character(M045077),
           natschools_1 = as.character(M000683), 
           natschools_3 = as.character(M023047A), 
           natschools_4 = as.character(M025108A), 
           natschools_5 = as.character(M045071a),
           natchld_1 = as.character(M000685), 
           natchld_3 = as.character(M023049), 
           natchld_4 = as.character(M025109), 
           natchld_5 = as.character(M045073),
           natfare_1 = as.character(M000676), 
           natfare_3 = as.character(M023046), 
           natfare_4 = as.character(M025107), 
           natfare_5 = as.character(M045070),
           natcrime_1 = as.character(M000684), 
           natcrime_3 = as.character(M023048), 
           natcrime_4 = as.character(M025109), 
           natcrime_5 = as.character(M045072),
           ftblacks_2 = as.character(M001308), 
           ftblacks_4 = as.character(M025055), 
           ftblacks_5 = as.character(M045023),
           ftwhites_2 = as.character(M001309), 
           ftwhites_4 = as.character(M025056), 
           ftwhites_5 = as.character(M045024),
           ftcons_2 = as.character(M001310), 
           ftcons_4 = as.character(M025057), 
           ftcons_5 = as.character(M045025),
           ftlibs_2 = as.character(M001311), 
           ftlibs_4 = as.character(M025058), 
           ftlibs_5 = as.character(M045026),
           ftbiz_2 = as.character(M001313), 
           ftbiz_4 = as.character(M025060), 
           ftbiz_5 = as.character(M045028),
           ftlabor_2 = as.character(M001312), 
           ftlabor_4 = as.character(M025059), 
           ftlabor_5 = as.character(M045027),
           ftmil_2 = as.character(M001306), 
           ftmil_4 = as.character(M025053), 
           ftmil_5 = as.character(M045021),
           fthisp_2 = as.character(M001316), 
           fthisp_4 = as.character(M025063), 
           fthisp_5 = as.character(M045031),
           fthomo_2 = as.character(M001321), 
           fthomo_4 = as.character(M025067), 
           fthomo_5 = as.character(M045035),
           ftpoor_2 = as.character(M001314), 
           ftpoor_4 = as.character(M025061), 
           ftpoor_5 = as.character(M045029),
           ftcath_2 = as.character(M001323), 
           ftcath_4 = as.character(M025068), 
           ftcath_5 = as.character(M045036),
           ftjews_2 = as.character(M001324), 
           ftjews_4 = as.character(M025069), 
           ftjews_5 = as.character(M045037),
           crooked_2 = as.character(M001537),
           crooked_4 = as.character(M025177), 
           crooked_5 = as.character(M045152),
           wastetax_2 = as.character(M001535), 
           wastetax_4 = as.character(M025175), 
           wastetax_5 = as.character(M045150),
           trustgov_2 = as.character(M001534), 
           trustgov_4 = as.character(M025174), 
           trustgov_5 = as.character(M045149),
           runfew_2 = as.character(M001536), 
           runfew_4 = as.character(M025176), 
           runfew_5 = as.character(M045151), 
           attentioncpg_1 = as.character(M000301),	
           attentioncpg_2 = as.character(M001201), 
           attentioncpg_3 = as.character(M023001),	
           attentioncpg_4 = as.character(M025001), 
           ppllikeme_2 = as.character(M001528),	
           ppllikeme_4 = as.character(M025173), 
           ppllikeme_5 = as.character(M045148), 
           natpoor_1 = as.character(M000680), 
           natpoor_3 = as.character(M023053A),	
           natpoor_4 = as.character(M025115A),	
           natpoor_5 = as.character(M045075a), 
           natarms_4 = as.character(M025105),	
           natarms_5 = as.character(M045081), 
           natrace_1 = as.character(M000687),
           natrace_3 =  as.character(M023057), 
           natrace_4 = as.character(M025119),	
           natrace_5 = as.character(M045079), 
           letin1a_1 = as.character(M000510),
           letin1a_4 = as.character(M045109), 
           opposehomo_2 = as.character(M001478),
           opposehomo_5 = as.character(M045111), 
           tax_3 = as.character(M023069),
           tax_4 = as.character(M025141),
           tax_5 = as.character(M045119), 
           ftasianamericans_2 = as.character(M001327), 
           ftasianamericans_4 = as.character(M025072),
           ftasianamericans_5 = as.character(M045040), 
           ftfeminists_2 = as.character(M001326),
           ftfeminists_4 = as.character(M025071), 
           ftfeminists_5 = as.character(M045039), 
           ftwelfare_2 = as.character(M001315),
           ftwelfare_4 = as.character(M025062),
           ftwelfare_5 = as.character(M045030), 
           ftenvironmental_2 = as.character(M001320), 
           ftenvironmental_4 = as.character(M025066),
           ftenvironmental_5 = as.character(M045034), 
           religimp_1 = as.character(M000872),
           religimp_3 = as.character(M023082),
           religimp_5 = as.character(M045173),
           # Many vote (2,4,5: 5pt; NA:0,9, 8-3)
           manyvote_2 = as.character(M001520), 
           manyvote_4 = as.character(M025171), 
           manyvote_5 = as.character(M045146),
           # Pol dont care (2,4,5; 5 pt; NA: 0,9; 8-3)
           dontcare_2 = as.character(M001527), 
           dontcare_4 = as.character(M025172), 
           dontcare_5 = as.character(M045147),
           # elections matter (2,4,5; 5 pt, NA: 0,8,9)
           elexmatter_2 = as.character(M001538), 
           elexmatter_4 = as.character(M025178), 
           elexmatter_5 = as.character(M045153),
           satdemo_2 = as.character(M001651), 
           satdemo_4 = as.character(M025179), 
           satdemo_5 = as.character(M045154)
    ) %>% 
    select(c(id, weight_1:weight_5, age_1:age_5, date_1:satdemo_5)) %>%
    pivot_longer(weight_1:satdemo_5) %>%
    separate(name, into = c("measure", "wave")) %>%
    spread(measure, value) %>%
    mutate(date = as.Date(date),
           across(c(abortion:crooked, dontcare:weight),
                  ~as.numeric(.x)),
           partyid = (partyid/6)*100,
           across(c(polviews, spendserv),
                  ~(.x-1)/6*100),
           across(c(trust, fair, helpful,
                    stayhome, crooked, wastetax,
                    runfew, attentioncpg, ppllikeme, 
                    letin1a, opposehomo, tax, 
                    religimp, manyvote, dontcare,
                    elexmatter),
                  ~(.x - 1)/4*100),
           across(c(abortion, satdemo),
                  ~(.x-1)/3*100),
           across(c(natenvir, nataid,
                    nataids, natsoc, natschools, natchld,
                    natfare, natcrime, natpoor, 
                    trustgov, natarms, natrace),
                  ~(.x-1)/2*100)) %>%
    pivot_longer(c(abortion,attentioncpg,crooked, dontcare:wastetax)) %>%
    filter(!is.na(age), !is.na(value), !is.na(date)) %>% arrange(id, name, date) %>%
    mutate(df = "2000-04 ANES")
  
  return(cleaned)
  
}